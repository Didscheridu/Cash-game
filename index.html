<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Enterprise</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0b1120; --panel: #1e293b; --border: #334155;
            --accent: #38bdf8; --green: #22c55e; --red: #ef4444; --gold: #eab308;
            --text: #f8fafc;
        }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; user-select: none; }
        
        /* LAYOUT & ANIMATIONS */
        .view { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; max-width: 1600px; margin: 0 auto; }
        .view.active { display: block; animation: fade 0.3s; }
        @keyframes fade { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        @keyframes flash { 0% { background: var(--green); } 100% { background: var(--panel); } }

        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--panel); padding: 15px; border-radius: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn { background: var(--border); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn:hover { filter: brightness(1.2); }
        .btn:active { transform: scale(0.95); }
        .btn-green { background: var(--green); color: black; }
        .btn-red { background: var(--red); color: white; }
        .btn-accent { background: var(--accent); color: black; }
        .btn-gold { background: var(--gold); color: black; }

        /* MENU */
        #menu { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle at top, #1e293b 0%, #0b1120 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 900px; width: 100%; padding: 20px; }
        .card { background: var(--panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* COMPANY DASHBOARD */
        .dash-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
        .reputation-bar-bg { width: 200px; height: 10px; background: #000; border-radius: 5px; overflow: hidden; display: inline-block; vertical-align: middle; margin-left: 10px; }
        .reputation-bar-fill { height: 100%; background: var(--gold); width: 0%; transition: width 0.5s; }

        .dept-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .dept-card { background: #162032; padding: 15px; border-radius: 10px; border-top: 4px solid #666; position: relative; }
        .dept-buy { border-color: var(--accent); } .dept-make { border-color: var(--gold); } .dept-sell { border-color: var(--green); }
        
        .contract-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px; }
        .contract-card { background: var(--panel); border: 1px solid var(--border); padding: 15px; border-radius: 8px; animation: fade 0.5s; }
        .contract-special { border: 1px solid var(--gold); box-shadow: 0 0 10px rgba(234, 179, 8, 0.2); }

        /* STOCK MARKET */
        .stock-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 85vh; }
        .list-panel { background: var(--panel); border-radius: 12px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 12px; border-bottom: 1px solid var(--border); text-align: left; }
        tr:hover { background: #334155; cursor: pointer; }

        /* NOTIFICATIONS & MODALS */
        #notif-area { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .notif { background: rgba(15, 23, 42, 0.95); border-left: 4px solid var(--accent); padding: 15px; width: 300px; color: white; border-radius: 6px; animation: fade 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-content { background: var(--panel); padding: 40px; border-radius: 15px; border: 1px solid var(--accent); width: 90%; max-width: 500px; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; text-align: left; }
        .report-val { text-align: right; font-weight: bold; }
    </style>
</head>
<body>

    <div id="notif-area"></div>

    <div id="menu">
        <h1 style="color:var(--accent); font-size:4em; margin:0; letter-spacing: 5px;">CEO SIM</h1>
        <p style="color:#64748b; margin-bottom: 30px;">ENTERPRISE EDITION 20.0</p>
        <h2 style="color:var(--green); font-family:monospace; font-size:3em; margin-bottom:50px;" class="display-cash"></h2>
        <div class="menu-grid">
            <div class="card" onclick="nav('company')"><h1>üè¢</h1><h2>Firma managen</h2><p>Auftr√§ge, Kunden & Reputation</p></div>
            <div class="card" onclick="nav('stocks')"><h1>üìà</h1><h2>Aktienmarkt</h2><p>Handel & Charts</p></div>
            <div class="card" onclick="nav('estate')"><h1>üèôÔ∏è</h1><h2>Immobilien</h2><p>Vermietung</p></div>
            <div class="card" onclick="nav('casino')"><h1>üé∞</h1><h2>Casino</h2><p>Gl√ºcksspiel</p></div>
        </div>
    </div>

    <div id="view-company" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>

        <div id="comp-create" style="max-width:500px; margin:50px auto; text-align:center;">
            <h1>Firma Gr√ºnden</h1>
            <input id="c-name" placeholder="Firmenname" style="font-size:1.2em; padding:10px; width:100%; margin-bottom:10px; background:var(--bg); border:1px solid var(--border); color:white;">
            <p>W√§hle Fokus:</p>
            <select id="c-focus" style="font-size:1.2em; padding:10px; width:100%; margin-bottom:20px; background:var(--bg); border:1px solid var(--border); color:white;">
                <option value="tech">Tech (High Risk, High Reward)</option>
                <option value="food">Nahrung (Sicher, Geringe Marge)</option>
                <option value="auto">Automobil (Teuer, Hoher Gewinn)</option>
            </select>
            <p style="color:var(--gold)">Kosten: 50.000 ‚Ç¨</p>
            <button class="btn btn-green" style="font-size:1.2em; width:100%" onclick="startCompany()">Gr√ºnden</button>
        </div>

        <div id="comp-dash" style="display:none;">
            <div class="dash-header">
                <div>
                    <h1 id="comp-name-display" style="margin:0">NAME</h1>
                    <small style="color:#888">CEO: DU</small>
                </div>
                <div>
                    Ruf: <span id="comp-rep-val">0</span>% 
                    <div class="reputation-bar-bg"><div id="comp-rep-bar" class="reputation-bar-fill"></div></div>
                </div>
            </div>

            <div class="dept-grid">
                <div class="dept-card dept-buy">
                    <h3>üì¶ EINKAUF</h3>
                    <p>Beschafft Rohstoffe.</p>
                    <div style="font-size:2em; font-weight:bold" id="raw-stock">0</div>
                    <small>Rohmaterial</small>
                    <hr style="border-color:#333; margin:10px 0;">
                    <p>Personal: <span id="staff-buy">0</span></p>
                    <button class="btn btn-green" onclick="hire('buy')">+ Hire</button>
                    <button class="btn btn-red" onclick="fire('buy')">-</button>
                </div>

                <div class="dept-card dept-make">
                    <h3>‚öôÔ∏è FABRIK</h3>
                    <p>Produziert Ware.</p>
                    <div style="font-size:2em; font-weight:bold; color:var(--gold)" id="fin-stock">0</div>
                    <small>Produkte im Lager</small>
                    <div style="height:5px; background:#000; margin-top:5px;"><div id="prod-bar" style="height:100%; width:0%; background:var(--gold)"></div></div>
                    <hr style="border-color:#333; margin:10px 0;">
                    <p>Personal: <span id="staff-make">0</span></p>
                    <button class="btn btn-green" onclick="hire('make')">+ Hire</button>
                    <button class="btn btn-red" onclick="fire('make')">-</button>
                </div>

                <div class="dept-card dept-sell">
                    <h3>ü§ù VERTRIEB</h3>
                    <p>Findet Kunden & verkauft.</p>
                    <div style="font-size:2em; font-weight:bold; color:var(--green)" id="sales-last">0</div>
                    <small>Verk√§ufe (letzte Minute)</small>
                    <hr style="border-color:#333; margin:10px 0;">
                    <p>Personal: <span id="staff-sell">0</span></p>
                    <button class="btn btn-green" onclick="hire('sell')">+ Hire</button>
                    <button class="btn btn-red" onclick="fire('sell')">-</button>
                </div>
            </div>

            <h2 style="border-top:1px solid var(--border); padding-top:20px;">üìú Auftr√§ge & Kunden</h2>
            <p style="color:#888">Deine Vertriebler suchen automatisch nach Kunden. Spezialauftr√§ge bringen Ruhm & Geld.</p>
            <div id="contract-area" class="contract-list">
                </div>
        </div>
    </div>

    <div id="view-stocks" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div class="stock-layout">
            <div class="list-panel"><table><thead><tr><th>Aktie</th><th>Kurs</th></tr></thead><tbody id="stock-list"></tbody></table></div>
            <div style="background:var(--panel); padding:20px; border-radius:12px; display:flex; flex-direction:column;">
                <div style="display:flex; justify-content:space-between;"><h1 id="st-name">Apple</h1><h1 id="st-price">--</h1></div>
                <div style="flex:1; position:relative;"><canvas id="chart"></canvas></div>
                <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <input id="st-qty" type="number" value="10" style="grid-column:span 2; background:var(--bg); border:1px solid var(--border); padding:10px; color:white;">
                    <button class="btn btn-green" onclick="tradeStock('buy')">Kaufen</button>
                    <button class="btn btn-red" onclick="tradeStock('sell')">Verkaufen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-estate" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div id="estate-list" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px;"></div>
    </div>

    <div id="view-casino" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div style="text-align:center; margin-top:50px">
            <h1 style="font-size:5em">üé∞</h1>
            <input type="number" id="bet" placeholder="Einsatz" style="font-size:1.5em; width:200px; background:var(--bg); border:1px solid var(--border); color:white; padding:10px;">
            <br><br>
            <button class="btn btn-red" onclick="spin()">Rot/Schwarz</button>
        </div>
    </div>

    <div id="modal-report" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--accent)">Finanzbericht (1 Min)</h2>
            <div class="report-grid">
                <span>Einnahmen (Verkauf):</span> <span class="report-val" id="rep-sales" style="color:var(--green)">+0 ‚Ç¨</span>
                <span>Einnahmen (Auftr√§ge):</span> <span class="report-val" id="rep-contracts" style="color:var(--gold)">+0 ‚Ç¨</span>
                <span>Personalkosten:</span> <span class="report-val" id="rep-wages" style="color:var(--red)">-0 ‚Ç¨</span>
                <span>Materialkosten:</span> <span class="report-val" id="rep-mats" style="color:var(--red)">-0 ‚Ç¨</span>
                <hr style="grid-column:span 2; border-color:#333;">
                <span>GEWINN:</span> <span class="report-val" id="rep-profit">0 ‚Ç¨</span>
            </div>
            <button class="btn btn-accent" style="width:100%" onclick="closeModals()">Weiterarbeiten</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        let cash = 60000;
        let company = null;
        let stocks = [];
        const stockNames = ["TechGlobal", "FruitInc", "SoftMicro", "SpaceX", "SolarEnergy"];
        let reportData = { sales:0, contracts:0, wages:0, mats:0 };
        let offers = [];
        
        // --- CORE ---
        function fmt(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function notify(msg) {
            let n=document.createElement('div'); n.className='notif'; n.innerText=msg; 
            document.getElementById('notif-area').appendChild(n); setTimeout(()=>n.remove(),3000);
        }
        function ui() {
            document.querySelectorAll('.display-cash').forEach(e=>e.innerText=fmt(cash));
            if(company) updateCompUI();
        }
        function nav(id) {
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.getElementById('menu').style.display=id==='menu'?'flex':'none';
            if(id!=='menu') document.getElementById('view-'+id).classList.add('active');
            if(id==='stocks') resizeChart();
            if(id==='estate') renderEstate();
        }
        function closeModals() { document.querySelectorAll('.modal').forEach(e=>e.style.display='none'); }

        // --- COMPANY SYSTEM ---
        function startCompany() {
            let n = document.getElementById('c-name').value;
            if(!n) return alert("Name fehlt!");
            if(cash<50000) return alert("Zu wenig Geld!");
            cash-=50000;
            
            company = {
                name: n, rep: 0, 
                raw: 0, fin: 0,
                staff: { buy:0, make:0, sell:0 },
                progress: 0
            };
            document.getElementById('comp-create').style.display='none';
            document.getElementById('comp-dash').style.display='block';
            document.getElementById('comp-name-display').innerText=n;
            ui();
        }

        function hire(role) { if(cash>=500){cash-=500; company.staff[role]++; ui();} }
        function fire(role) { if(company.staff[role]>0){company.staff[role]--; ui();} }

        // MAIN COMPANY LOOP (100ms)
        setInterval(() => {
            if(!company) return;

            // 1. EINKAUF
            if(company.staff.buy > 0 && company.raw < company.staff.buy*20) {
                if(Math.random() < 0.05 * company.staff.buy) {
                    let cost = 50; 
                    if(cash>=cost) { cash-=cost; company.raw++; reportData.mats+=cost; }
                }
            }

            // 2. PRODUKTION
            if(company.staff.make > 0 && company.raw > 0) {
                company.progress += company.staff.make;
                if(company.progress >= 100) {
                    company.progress = 0; company.raw--; company.fin++;
                }
            }
            document.getElementById('prod-bar').style.width = Math.min(100, company.progress)+"%";

            // 3. VERTRIEB (Normaler Verkauf)
            if(company.staff.sell > 0 && company.fin > 0) {
                // Verkauft langsam an Endkunden
                if(Math.random() < 0.02 * company.staff.sell) {
                    let price = 150 + (company.rep * 2); // Mehr Ruf = H√∂here Preise
                    company.fin--; cash += price; 
                    reportData.sales += price;
                    notify(`Produkt verkauft: +${price}‚Ç¨`);
                }
            }

            ui();
        }, 100);

        // MARKETING & AUFTR√ÑGE (1 Sekunde)
        setInterval(() => {
            if(!company) return;
            
            // Verk√§ufer generieren Angebote (Leads)
            if(company.staff.sell > 0) {
                if(Math.random() < 0.1 * company.staff.sell && offers.length < 3) {
                    generateOffer();
                }
            }
        }, 1000);

        function generateOffer() {
            let size = Math.floor(Math.random() * 10) + 5 + company.rep; // Gr√∂√üe
            let pay = size * 200; // 200‚Ç¨ pro St√ºck (besser als normal 150‚Ç¨)
            let id = Date.now();
            
            let type = Math.random()>0.8 ? "Spezial" : "Standard";
            let css = type==="Spezial" ? "contract-special" : "";
            
            offers.push({id:id, size:size, pay:pay, type:type});
            renderContracts();
            if(type==="Spezial") notify("‚≠ê Gro√ükunde hat Interesse!");
        }

        function renderContracts() {
            let d = document.getElementById('contract-area'); d.innerHTML="";
            if(offers.length===0) d.innerHTML="<p style='color:#666'>Deine Verk√§ufer suchen nach Kunden...</p>";
            
            offers.forEach(o => {
                let btn = company.fin >= o.size 
                    ? `<button class="btn btn-green" onclick="fulfillContract(${o.id})">Liefern</button>` 
                    : `<button class="btn" style="background:#333; cursor:not-allowed">Warte auf Ware (${company.fin}/${o.size})</button>`;
                
                d.innerHTML += `
                <div class="contract-card ${o.type==='Spezial'?'contract-special':''}">
                    <h3>${o.type}-Auftrag</h3>
                    <p>Ben√∂tigt: <b>${o.size} St√ºck</b></p>
                    <p style="color:var(--gold)">Zahlung: ${fmt(o.pay)}</p>
                    <div style="margin-top:10px; display:flex; gap:5px;">
                        ${btn}
                        <button class="btn btn-red" onclick="rejectContract(${o.id})">X</button>
                    </div>
                </div>`;
            });
        }

        function fulfillContract(id) {
            let o = offers.find(x=>x.id===id);
            if(company.fin >= o.size) {
                company.fin -= o.size;
                cash += o.pay;
                reportData.contracts += o.pay;
                
                // Ruf steigern
                company.rep = Math.min(100, company.rep + 2);
                
                offers = offers.filter(x=>x.id!==id);
                renderContracts();
                notify(`Auftrag erledigt! +${fmt(o.pay)}`);
                ui();
            }
        }

        function rejectContract(id) {
            offers = offers.filter(x=>x.id!==id);
            renderContracts();
        }

        function updateCompUI() {
            document.getElementById('raw-stock').innerText = company.raw;
            document.getElementById('fin-stock').innerText = company.fin;
            document.getElementById('staff-buy').innerText = company.staff.buy;
            document.getElementById('staff-make').innerText = company.staff.make;
            document.getElementById('staff-sell').innerText = company.staff.sell;
            
            document.getElementById('comp-rep-val').innerText = company.rep;
            document.getElementById('comp-rep-bar').style.width = company.rep+"%";
            
            document.getElementById('sales-last').innerText = fmt(reportData.sales);
            
            renderContracts(); // Update buttons based on stock
        }

        // MINUTE REPORT LOOP (60s)
        setInterval(() => {
            if(!company) return;
            
            // Lohnkosten berechnen
            let totalStaff = company.staff.buy + company.staff.make + company.staff.sell;
            let wageBill = totalStaff * 500; // 500‚Ç¨ pro Minute pro Nase
            
            if(cash < wageBill) {
                notify("Konnte L√∂hne nicht zahlen! Mitarbeiter k√ºndigen.", "bad");
                company.staff.buy=0; company.staff.make=0; company.staff.sell=0;
                wageBill = 0; // Schulden nicht implementiert
            } else {
                cash -= wageBill;
            }
            reportData.wages = wageBill;

            // Show Modal
            document.getElementById('rep-sales').innerText = "+"+fmt(reportData.sales);
            document.getElementById('rep-contracts').innerText = "+"+fmt(reportData.contracts);
            document.getElementById('rep-wages').innerText = "-"+fmt(reportData.wages);
            document.getElementById('rep-mats').innerText = "-"+fmt(reportData.mats);
            
            let profit = (reportData.sales + reportData.contracts) - (reportData.wages + reportData.mats);
            let elProfit = document.getElementById('rep-profit');
            elProfit.innerText = fmt(profit);
            elProfit.style.color = profit >= 0 ? 'var(--green)' : 'var(--red)';
            
            document.getElementById('modal-report').style.display = 'flex';

            // Reset Data
            reportData = { sales:0, contracts:0, wages:0, mats:0 };
            
        }, 60000);


        // --- STOCKS ---
        stockNames.forEach((n,i)=>stocks.push({id:i, name:n, price:Math.random()*100+50, hist:Array(40).fill(100), owned:0}));
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {type:'line', data:{labels:Array(40).fill(''), datasets:[{data:[], borderColor:'#38bdf8', borderWidth:2, pointRadius:0, tension:0.1}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}}}});
        
        let selStockId=0;
        setInterval(() => {
            stocks.forEach(s=>{ s.price += (Math.random()-0.5)*5; if(s.price<1)s.price=1; s.hist.shift(); s.hist.push(s.price); });
            if(document.getElementById('view-stocks').classList.contains('active')) {
                let h=""; stocks.forEach(s=>h+=`<tr onclick="selStock(${s.id})"><td><b>${s.name}</b></td><td>${s.price.toFixed(2)}</td></tr>`);
                document.getElementById('stock-list').innerHTML=h; updateChart();
            }
        }, 1000);
        function selStock(id){selStockId=id;updateChart();}
        function updateChart(){ 
            let s=stocks[selStockId]; document.getElementById('st-name').innerText=s.name; document.getElementById('st-price').innerText=s.price.toFixed(2)+"‚Ç¨";
            chart.data.datasets[0].data=s.hist; chart.update('none');
        }
        function resizeChart(){setTimeout(()=>chart.resize(),100);}
        function tradeStock(t){
            let s=stocks[selStockId]; let q=10;
            if(t==='buy'&&cash>=s.price*q){cash-=s.price*q; s.owned+=q;}
            if(t==='sell'&&s.owned>=q){cash+=s.price*q; s.owned-=q;}
            ui();
        }

        // --- ESTATE & CASINO (Basic) ---
        const props = [{n:"Kiosk",c:15000,i:500},{n:"Supermarkt",c:100000,i:5000}];
        function renderEstate(){
            let d=document.getElementById('estate-list'); d.innerHTML="";
            props.forEach(p=>d.innerHTML+=`<div style="background:var(--panel);padding:15px;border-radius:10px;border:1px solid var(--border)"><h3>${p.n}</h3><p>Miete: ${p.i}‚Ç¨</p><button class="btn btn-green" onclick="buyProp(${p.c},${p.i})">Kaufen ${fmt(p.c)}</button></div>`);
        }
        function buyProp(c,i){if(cash>=c){cash-=c; setInterval(()=>{cash+=i;notify(`Miete +${i}‚Ç¨`);ui()},15000); notify("Gekauft!"); ui();}}
        function spin(){let b=parseInt(document.getElementById('bet').value);if(b&&cash>=b){cash-=b;if(Math.random()>0.5){cash+=b*2;notify("Gewonnen!");}else notify("Verloren");ui();}}

        ui();
    </script>
</body>
</html>
