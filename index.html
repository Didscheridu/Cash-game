<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Pro Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --accent: #38bdf8;
            --green: #22c55e;
            --red: #ef4444;
            --gold: #eab308;
            --text: #f8fafc;
        }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            padding: 0;
            user-select: none;
            overflow: hidden; 
        }

        /* --- ANIMATIONEN --- */
        @keyframes spinSlot { 0% { transform: translateY(-100%); opacity:0; } 100% { transform: translateY(0); opacity:1; } }
        @keyframes glow { 0% { box-shadow: 0 0 5px var(--gold); } 50% { box-shadow: 0 0 20px var(--gold); } 100% { box-shadow: 0 0 5px var(--gold); } }

        /* --- UI STRUKTUR --- */
        .game-view { display: none; height: 100vh; box-sizing: border-box; padding: 20px; max-width: 1200px; margin: 0 auto; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg-panel); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #334155; }
        .back-btn { background: #334155; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        button { cursor: pointer; transition: 0.2s; border: none; }
        button:active { transform: scale(0.95); }
        input { background: #0f172a; border: 1px solid #334155; color: white; border-radius: 5px; text-align: center; padding: 8px; }

        /* --- AKTIEN LAYOUT --- */
        .stock-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 85vh; }
        .stock-list-container { overflow-y: auto; background: var(--bg-panel); border-radius: 12px; border: 1px solid #334155; }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #0f172a; padding: 12px; text-align: left; color: #94a3b8; z-index: 2; border-bottom: 1px solid #334155;}
        td { padding: 15px 12px; border-bottom: 1px solid #334155; cursor: pointer; font-variant-numeric: tabular-nums; }
        tr:hover { background: #334155; }
        
        .timer-bar { height: 4px; background: #334155; width: 100%; margin-top: 5px; position: relative; }
        .timer-fill { height: 100%; background: var(--accent); width: 0%; transition: width 1s linear; }

        /* --- CASINO --- */
        .casino-tabs { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .tab-btn { background: var(--bg-panel); color: #94a3b8; padding: 10px 20px; border-radius: 8px; font-weight: bold; }
        .tab-btn.active { background: var(--accent); color: #000; }
        
        .casino-game { display: none; background: var(--bg-panel); padding: 30px; border-radius: 20px; text-align: center; max-width: 600px; margin: 0 auto; border: 1px solid #334155; }
        .casino-game.active { display: block; animation: spinSlot 0.5s ease-out; }

        /* SLOTS */
        .slot-machine { display: flex; gap: 10px; justify-content: center; margin: 20px 0; background: #000; padding: 20px; border-radius: 10px; border: 4px solid var(--gold); }
        .slot-reel { font-size: 4em; background: #fff; width: 80px; height: 100px; display: flex; align-items: center; justify-content: center; border-radius: 5px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }
        .rolling { animation: spinSlot 0.1s infinite; }

        /* --- MEN√ú --- */
        #mainMenu { display: flex; flex-direction: column; align-items: center; height: 100vh; padding-top: 50px; background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 800px; width: 100%; }
        .menu-card { background: var(--bg-panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid #334155; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .menu-card:hover { transform: translateY(-5px); border-color: var(--accent); }

        /* --- HELPER --- */
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .btn-action { padding: 12px; font-weight: bold; border-radius: 6px; width: 100%; margin-top: 5px;}
        .trade-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }

    </style>
</head>
<body>

    <div id="mainMenu">
        <h1 style="color:var(--accent); font-size: 3em; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px;">Business Pro</h1>
        <h2 style="color:var(--green); margin-bottom: 50px; font-family: monospace; font-size: 2.5em;" id="menuCash">10.000 ‚Ç¨</h2>
        
        <div class="menu-grid">
            <div class="menu-card" onclick="openGame('stocks')">
                <div style="font-size: 4em;">üìà</div>
                <h2>Aktienmarkt</h2>
                <p style="color:#94a3b8">Realtime Charts (5s Tick)</p>
            </div>
            <div class="menu-card" onclick="openGame('casino')">
                <div style="font-size: 4em;">üé∞</div>
                <h2>Casino Royale</h2>
                <p style="color:#94a3b8">Slots, Roulette, High/Low</p>
            </div>
            <div class="menu-card" onclick="alert('Im Moment im Umbau!')">
                <div style="font-size: 4em;">üèôÔ∏è</div>
                <h2>Tycoon</h2>
                <p style="color:#94a3b8">Coming Soon</p>
            </div>
        </div>
    </div>

    <div id="view-stocks" class="game-view">
        <div class="top-bar">
            <button class="back-btn" onclick="goHome()">üè† Dashboard</button>
            <div style="text-align: right;">
                <span class="global-cash" style="font-family: monospace; font-size: 1.2em; color: var(--green);"></span>
                <div class="timer-bar"><div id="marketTimer" class="timer-fill"></div></div>
            </div>
        </div>
        
        <div class="stock-layout">
            <div class="stock-list-container">
                <table>
                    <thead><tr><th>Unternehmen</th><th>Kurs</th><th>Besitz</th></tr></thead>
                    <tbody id="stockTableBody"></tbody>
                </table>
            </div>
            <div style="background: var(--bg-panel); padding: 20px; border-radius: 12px; display: flex; flex-direction: column; border: 1px solid #334155;">
                <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:15px;">
                    <div>
                        <h2 id="stockNameDisplay" style="margin:0; font-size: 1.8em;">Apple Inc.</h2>
                        <small style="color:#94a3b8">NASDAQ: AAPL</small>
                    </div>
                    <h2 id="stockPriceDisplay" style="margin:0; font-family: monospace; font-size: 2em;">--</h2>
                </div>
                
                <div style="flex-grow:1; position:relative; min-height: 300px;">
                    <canvas id="stockChartCanvas"></canvas>
                </div>

                <div style="margin-top: 20px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="number" id="stockInput" value="10" min="1" style="flex-grow: 1;">
                        <button class="btn-action" style="background: #334155; color: white; width: auto;" onclick="buyMax()">MAX</button>
                    </div>
                    <div class="trade-grid">
                        <button class="btn-action" style="background:var(--green); color:black" onclick="tradeManual('buy')">KAUFEN</button>
                        <button class="btn-action" style="background:var(--red); color:white" onclick="tradeManual('sell')">VERKAUFEN</button>
                    </div>
                    <button class="btn-action" style="background:#000; color:var(--accent); border:1px solid var(--accent)" onclick="toggleBot()">ü§ñ Auto-Trader (Alle 5s)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-casino" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Dashboard</button><span class="global-cash"></span></div>
        
        <div class="casino-tabs">
            <button class="tab-btn active" onclick="switchCasino('slots', this)">üé∞ Slots</button>
            <button class="tab-btn" onclick="switchCasino('roulette', this)">üî¥ Roulette</button>
            <button class="tab-btn" onclick="switchCasino('highlow', this)">üìà High/Low</button>
        </div>

        <div id="game-slots" class="casino-game active">
            <h2 style="color:var(--gold)">Golden Slots</h2>
            <div class="slot-machine">
                <div id="reel1" class="slot-reel">üçí</div>
                <div id="reel2" class="slot-reel">üçí</div>
                <div id="reel3" class="slot-reel">üçí</div>
            </div>
            <p>Einsatz: 100 ‚Ç¨ | Gewinn: 3x Symbol = 5.000 ‚Ç¨</p>
            <button class="btn-action" style="background:var(--gold); color:black; font-size:1.5em; max-width: 200px; margin: 0 auto;" onclick="spinSlots()">SPIN!</button>
            <p id="slotMsg" style="height: 20px; margin-top: 10px; font-weight: bold;"></p>
        </div>

        <div id="game-roulette" class="casino-game">
            <h2>Roulette</h2>
            <div style="font-size:5em; margin: 20px;" id="rouletteDisplay">üé≤</div>
            <input type="number" id="rouletteBet" placeholder="Einsatz" value="1000">
            <div class="trade-grid">
                <button class="btn-action" style="background:var(--red); color:white" onclick="playRoulette('red')">üî¥ Rot (x2)</button>
                <button class="btn-action" style="background:#000; color:white; border:1px solid white" onclick="playRoulette('black')">‚ö´ Schwarz (x2)</button>
            </div>
            <p id="rouletteMsg"></p>
        </div>

        <div id="game-highlow" class="casino-game">
            <h2>High or Low</h2>
            <p>Ist die n√§chste Zahl h√∂her oder niedriger als die aktuelle?</p>
            <div style="font-size:6em; font-weight:bold; color:var(--accent);" id="hlCurrent">50</div>
            <input type="number" id="hlBet" placeholder="Einsatz" value="500">
            <div class="trade-grid">
                <button class="btn-action" style="background:var(--green); color:black" onclick="playHighLow('high')">üîº H√ñHER</button>
                <button class="btn-action" style="background:var(--red); color:white" onclick="playHighLow('low')">üîΩ NIEDRIGER</button>
            </div>
            <p id="hlMsg"></p>
        </div>

    </div>

    <script>
        // --- CORE ---
        let cash = 10000;
        let botActive = false;
        
        function formatMoney(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function updateUI() {
            document.getElementById('menuCash').innerText = formatMoney(cash);
            document.querySelectorAll('.global-cash').forEach(e => e.innerText = formatMoney(cash));
        }
        function goHome() { document.querySelectorAll('.game-view').forEach(e => e.style.display='none'); document.getElementById('mainMenu').style.display='flex'; }
        function openGame(id) { document.getElementById('mainMenu').style.display='none'; document.getElementById('view-'+id).style.display='block'; if(id==='stocks') { resizeChart(); } }

        // --- AKTIEN SYSTEM (5 SEKUNDEN TICK) ---
        // Echte Firmennamen
        const companyData = [
            {name: "Apple Inc.", ticker: "AAPL", price: 180},
            {name: "Microsoft", ticker: "MSFT", price: 350},
            {name: "Amazon", ticker: "AMZN", price: 145},
            {name: "Tesla", ticker: "TSLA", price: 240},
            {name: "Nvidia", ticker: "NVDA", price: 460},
            {name: "Google", ticker: "GOOGL", price: 135},
            {name: "Netflix", ticker: "NFLX", price: 450}
        ];

        let stocks = companyData.map((c, i) => ({
            id: i, ...c, 
            history: [], 
            labels: [], // Zeitstempel f√ºr den Graphen
            owned: 0 
        }));

        let selectedStockId = 0;
        let stockChart;
        let tickCounter = 0;

        // Chart Init
        function initChart() {
            const ctx = document.getElementById('stockChartCanvas').getContext('2d');
            Chart.defaults.color = '#94a3b8';
            Chart.defaults.borderColor = '#334155';
            
            stockChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ 
                    label: 'Kursverlauf', 
                    data: [], 
                    borderColor: '#38bdf8', 
                    backgroundColor: 'rgba(56, 189, 248, 0.1)',
                    borderWidth: 3, 
                    fill: true,
                    pointRadius: 3, // Punkte sichtbar beim Hover
                    pointHoverRadius: 6,
                    tension: 0.4 
                }]},
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 1000, easing: 'linear' }, // Weicher √úbergang
                    interaction: { mode: 'index', intersect: false }, // Hover √ºberall
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            enabled: true,
                            backgroundColor: '#1e293b',
                            titleColor: '#fff',
                            bodyColor: '#38bdf8',
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(2) + ' ‚Ç¨';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { display: false }, // X-Achse ausblenden f√ºr cleaneren Look
                        y: { grid: { color: '#334155' } }
                    }
                }
            });
            // Initial History f√ºllen
            stocks.forEach(s => {
                for(let j=0; j<20; j++) {
                    s.history.push(s.price);
                    s.labels.push("");
                }
            });
        }

        // --- DER 5-SEKUNDEN MARKT LOOP ---
        function marketLoop() {
            let now = new Date().toLocaleTimeString(); // Zeitstempel holen

            stocks.forEach(s => {
                // Preis√§nderung: Realistischer Random Walk
                let change = (Math.random() - 0.5) * (s.price * 0.05); // Max 5% √Ñnderung
                s.price += change;
                if(s.price < 1) s.price = 1;

                // Daten speichern
                s.history.shift(); 
                s.history.push(s.price);
                
                s.labels.shift();
                s.labels.push(now); // Zeit speichern
            });

            // Bot (l√§uft jetzt alle 5 Sekunden)
            if(botActive) runBot();

            // UI Updates
            if(document.getElementById('view-stocks').style.display === 'block') {
                renderStockList();
                updateChart();
            }

            // Timer Balken Reset
            document.getElementById('marketTimer').style.transition = 'none';
            document.getElementById('marketTimer').style.width = '0%';
            setTimeout(() => {
                document.getElementById('marketTimer').style.transition = 'width 5s linear';
                document.getElementById('marketTimer').style.width = '100%';
            }, 50);
        }

        // Loop starten (Alle 5000ms)
        setInterval(marketLoop, 5000);
        setTimeout(marketLoop, 100); // Erster Run sofort

        function renderStockList() {
            let tbody = document.getElementById('stockTableBody');
            tbody.innerHTML = '';
            stocks.forEach(s => {
                let bg = s.id === selectedStockId ? 'background:#334155' : '';
                let prev = s.history[s.history.length-2];
                let color = s.price >= prev ? 'text-green' : 'text-red';
                let arrow = s.price >= prev ? '‚ñ≤' : '‚ñº';
                
                tbody.innerHTML += `
                <tr onclick="selectStock(${s.id})" style="${bg}">
                    <td><strong>${s.name}</strong><br><small style="color:#64748b">${s.ticker}</small></td>
                    <td class="${color}">${s.price.toFixed(2)}‚Ç¨ <small>${arrow}</small></td>
                    <td>${s.owned}</td>
                </tr>`;
            });
        }

        function selectStock(id) {
            selectedStockId = id;
            updateChart();
        }

        function updateChart() {
            let s = stocks[selectedStockId];
            document.getElementById('stockNameDisplay').innerText = s.name;
            document.getElementById('stockPriceDisplay').innerText = s.price.toFixed(2) + " ‚Ç¨";
            
            // Daten in Chart laden
            stockChart.data.labels = s.labels;
            stockChart.data.datasets[0].data = s.history;
            
            // Farbe anpassen je nach Trend
            let start = s.history[0];
            let end = s.price;
            stockChart.data.datasets[0].borderColor = end >= start ? '#22c55e' : '#ef4444';
            stockChart.data.datasets[0].backgroundColor = end >= start ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)';
            
            stockChart.update();
        }
        
        function resizeChart() { setTimeout(() => stockChart.resize(), 100); }

        // --- HANDEL FUNKTIONEN ---
        function getQty() { return parseInt(document.getElementById('stockInput').value) || 1; }
        
        function tradeManual(type) {
            let qty = getQty();
            let s = stocks[selectedStockId];
            if(type === 'buy') {
                if(cash >= s.price * qty) { cash -= s.price * qty; s.owned += qty; updateUI(); renderStockList(); }
            } else {
                if(s.owned >= qty) { cash += s.price * qty; s.owned -= qty; updateUI(); renderStockList(); }
            }
        }
        function buyMax() {
            let s = stocks[selectedStockId];
            let max = Math.floor(cash / s.price);
            if(max > 0) { cash -= max * s.price; s.owned += max; updateUI(); renderStockList(); }
        }
        function toggleBot() { 
            botActive = !botActive; 
            alert(botActive ? "Bot Aktiviert! Er handelt alle 5 Sekunden." : "Bot Deaktiviert."); 
        }
        function runBot() {
            // Simpler Bot: Kauft wenn Kurs niedrig im Verlauf, Verkauft wenn hoch
            stocks.forEach(s => {
                let avg = s.history.reduce((a,b)=>a+b,0)/s.history.length;
                if(s.price < avg * 0.95 && cash > s.price) { cash -= s.price; s.owned++; } // Buy Dip
                else if(s.price > avg * 1.05 && s.owned > 0) { cash += s.price; s.owned--; } // Sell High
            });
            updateUI();
        }

        // --- CASINO LOGIK ---
        function switchCasino(game, btn) {
            document.querySelectorAll('.casino-game').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('game-'+game).classList.add('active');
            btn.classList.add('active');
        }

        // 1. Slots
        const symbols = ['üçí', 'üçã', 'üçá', 'üíé', '7Ô∏è‚É£'];
        function spinSlots() {
            if(cash < 100) return alert("Zu wenig Geld!");
            cash -= 100; updateUI();
            
            let r1 = document.getElementById('reel1');
            let r2 = document.getElementById('reel2');
            let r3 = document.getElementById('reel3');
            let msg = document.getElementById('slotMsg');
            
            // Animation starten
            [r1,r2,r3].forEach(r => { r.innerText = '‚ùì'; r.classList.add('rolling'); });
            msg.innerText = "Dreht...";

            setTimeout(() => {
                [r1,r2,r3].forEach(r => r.classList.remove('rolling'));
                
                let s1 = symbols[Math.floor(Math.random()*symbols.length)];
                let s2 = symbols[Math.floor(Math.random()*symbols.length)];
                let s3 = symbols[Math.floor(Math.random()*symbols.length)];
                
                r1.innerText = s1; r2.innerText = s2; r3.innerText = s3;

                if(s1 === s2 && s2 === s3) {
                    let win = 5000;
                    if(s1 === '7Ô∏è‚É£') win = 20000; // Jackpot
                    cash += win;
                    msg.innerHTML = `<span style="color:var(--gold)">JACKPOT! +${formatMoney(win)}</span>`;
                } else if(s1 === s2 || s2 === s3 || s1 === s3) {
                    cash += 200; // Kleiner Gewinn
                    msg.innerHTML = `<span style="color:var(--green)">Kleiner Gewinn! +200‚Ç¨</span>`;
                } else {
                    msg.innerHTML = `<span style="color:var(--red)">Niete.</span>`;
                }
                updateUI();
            }, 1000);
        }

        // 2. Roulette
        function playRoulette(color) {
            let bet = parseInt(document.getElementById('rouletteBet').value);
            if(!bet || bet > cash) return;
            cash -= bet; updateUI();
            
            let resDisplay = document.getElementById('rouletteDisplay');
            resDisplay.style.transform = "rotate(360deg)";
            resDisplay.style.transition = "1s";
            
            setTimeout(() => {
                resDisplay.style.transform = "rotate(0deg)";
                resDisplay.style.transition = "0s";
                
                let winColor = Math.random() > 0.5 ? 'red' : 'black';
                resDisplay.innerText = winColor === 'red' ? 'üî¥' : '‚ö´';
                
                if(winColor === color) {
                    cash += bet * 2;
                    document.getElementById('rouletteMsg').innerHTML = "<b class='text-green'>GEWONNEN!</b>";
                } else {
                    document.getElementById('rouletteMsg').innerHTML = "<b class='text-red'>VERLOREN!</b>";
                }
                updateUI();
            }, 1000);
        }

        // 3. High / Low
        let currentNum = 50;
        function playHighLow(guess) {
            let bet = parseInt(document.getElementById('hlBet').value);
            if(!bet || bet > cash) return;
            cash -= bet;
            
            let nextNum = Math.floor(Math.random() * 100) + 1;
            let won = false;
            
            if(guess === 'high' && nextNum > currentNum) won = true;
            if(guess === 'low' && nextNum < currentNum) won = true;
            
            document.getElementById('hlCurrent').innerText = nextNum;
            
            let msg = document.getElementById('hlMsg');
            if(won) {
                cash += Math.floor(bet * 1.5);
                msg.innerHTML = `<span class="text-green">Richtig! (${currentNum} -> ${nextNum})</span>`;
            } else {
                msg.innerHTML = `<span class="text-red">Falsch! (${currentNum} -> ${nextNum})</span>`;
            }
            currentNum = nextNum;
            updateUI();
        }

        // INIT
        initChart();
        updateUI();

    </script>
</body>
</html>
