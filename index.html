<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Juicy Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --bg-panel: #161616;
            --accent: #FFD700; /* Gold */
            --green: #00ff88;
            --red: #ff3333;
            --blue: #00ccff;
            --purple: #d500f9;
        }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-dark);
            color: white;
            margin: 0;
            padding: 0;
            user-select: none;
            overflow: hidden; /* Kein Scrollen der Hauptseite */
        }

        /* --- ANIMATIONEN DEFINITIONEN --- */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: white; text-shadow: 0 0 10px white; }
            100% { transform: scale(1); }
        }

        @keyframes flashGreen { 0% { background-color: rgba(0,255,136, 0.5); } 100% { background-color: transparent; } }
        @keyframes flashRed { 0% { background-color: rgba(255, 51, 51, 0.5); } 100% { background-color: transparent; } }

        /* --- UI ELEMENTE --- */
        .game-view { 
            display: none; 
            height: 100vh; 
            box-sizing: border-box; 
            padding: 20px; 
            max-width: 1200px; 
            margin: 0 auto; 
            animation: fadeInScale 0.3s ease-out; /* View Animation */
        }

        .cash-pulse { animation: pop 0.3s ease; }

        /* Hauptmen√º */
        #mainMenu {
            display: flex; flex-direction: column; align-items: center; justify-content: start;
            height: 100vh; padding: 40px 20px; overflow-y: auto;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
        }
        .menu-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; width: 100%; max-width: 1000px;
        }
        .menu-card {
            background: var(--bg-panel); padding: 25px; border-radius: 15px; border: 1px solid #333;
            cursor: pointer; transition: 0.3s; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .menu-card:hover { transform: translateY(-10px) scale(1.02); border-color: var(--accent); box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }
        
        /* Top Bar */
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; border-bottom: 2px solid #333; }
        .back-btn { background: #444; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .back-btn:hover { background: #666; }

        /* --- AKTIEN STYLE --- */
        .stock-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 80vh; }
        .stock-list-container { overflow-y: auto; background: var(--bg-panel); border-radius: 12px; border: 1px solid #333; }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #222; padding: 10px; z-index: 2; text-align: left; color: #888; }
        td { padding: 12px 10px; border-bottom: 1px solid #222; cursor: pointer; transition: background 0.2s; }
        tr:hover { background: #333; }
        
        .flash-g { animation: flashGreen 0.5s; }
        .flash-r { animation: flashRed 0.5s; }
        
        /* Chart Container */
        .chart-wrapper { background: var(--bg-panel); border-radius: 12px; padding: 20px; border: 1px solid #333; display: flex; flex-direction: column; position: relative; }
        .buy-sell-row { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; color: #000; cursor: pointer; font-size: 1.1em; transition: transform 0.1s; }
        .action-btn:active { transform: scale(0.95); }

        /* --- AUKTION STYLE --- */
        .chest-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 40px; }
        .chest-card { 
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a); padding: 30px; 
            border-radius: 15px; border: 2px solid #444; cursor: pointer; transition: 0.3s; 
            display: flex; flex-direction: column; align-items: center;
        }
        .chest-card:hover { border-color: var(--purple); box-shadow: 0 0 15px rgba(213, 0, 249, 0.4); }
        .chest-icon { font-size: 6em; transition: 0.3s; display: block; }
        
        .shaking { animation: shake 0.5s; animation-iteration-count: infinite; }
        
        /* --- TYCOON --- */
        .tycoon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .building-card { background: var(--bg-panel); padding: 15px; border-radius: 10px; border: 1px solid #333; transition: 0.2s; }
        .building-card:hover { border-color: var(--blue); transform: translateY(-3px); }

    </style>
</head>
<body>

    <div id="mainMenu">
        <h1 style="font-size: 3.5em; color: var(--accent); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">Business Imperium</h1>
        <h2 id="menuCash" style="color: var(--green); font-size: 2.5em; margin-bottom: 40px;">10.000 ‚Ç¨</h2>

        <div class="menu-grid">
            <div class="menu-card" onclick="openGame('stocks')">
                <span style="font-size: 4em;">üìà</span>
                <h3>Wall Street</h3>
                <p style="color:#888; font-size:0.9em;">Echtzeit Handel</p>
            </div>
            <div class="menu-card" onclick="openGame('loot')">
                <span style="font-size: 4em;">üì¶</span>
                <h3>Auktionen</h3>
                <p style="color:#888; font-size:0.9em;">Gl√ºck & Mystery</p>
            </div>
            <div class="menu-card" onclick="openGame('casino')">
                <span style="font-size: 4em;">üé∞</span>
                <h3>Casino</h3>
                <p style="color:#888; font-size:0.9em;">Alles oder nichts</p>
            </div>
            <div class="menu-card" onclick="openGame('tycoon')">
                <span style="font-size: 4em;">üè®</span>
                <h3>Immobilien</h3>
                <p style="color:#888; font-size:0.9em;">Passives Einkommen</p>
            </div>
            <div class="menu-card" onclick="openGame('heist')">
                <span style="font-size: 4em;">üïµÔ∏è</span>
                <h3>Tresor</h3>
                <p style="color:#888; font-size:0.9em;">Skill Minigame</p>
            </div>
        </div>
    </div>

    <div id="view-stocks" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Zur√ºck</button><span class="global-cash" style="font-size:1.5em; color:var(--green); font-weight:bold;"></span></div>
        <div class="stock-layout">
            <div class="stock-list-container">
                <table>
                    <thead><tr><th>Aktie</th><th>Preis</th><th>Besitz</th></tr></thead>
                    <tbody id="stockTableBody"></tbody>
                </table>
            </div>
            <div class="chart-wrapper">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h2 id="stockNameDisplay" style="margin:0;">W√§hle eine Aktie</h2>
                    <h2 id="stockPriceDisplay" style="margin:0;">--</h2>
                </div>
                <div style="flex-grow: 1; position: relative; min-height: 300px;">
                    <canvas id="stockChartCanvas"></canvas>
                </div>
                <div class="buy-sell-row">
                    <button class="action-btn" style="background:var(--green);" onclick="tradeStock(1)">KAUFEN</button>
                    <button class="action-btn" style="background:var(--red); color:white;" onclick="tradeStock(-1)">VERKAUFEN</button>
                </div>
                <button onclick="boostStock()" style="margin-top:10px; background:var(--accent); color:black; font-weight:bold; padding:10px; border:none; border-radius:5px; cursor:pointer;">üöÄ BOOST (15s)</button>
            </div>
        </div>
    </div>

    <div id="view-loot" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Zur√ºck</button><span class="global-cash" style="font-size:1.5em; color:var(--green); font-weight:bold;"></span></div>
        
        <div style="text-align: center; margin-top: 50px;">
            <h1 style="color:var(--purple);">Lagerraum Auktionen</h1>
            <p>Klicke auf einen Container um ihn zu ersteigern!</p>
            
            <div class="chest-grid">
                <div class="chest-card" id="chest1" onclick="openChest(1, 100)">
                    <span class="chest-icon">üì¶</span>
                    <h3>Small Box</h3>
                    <p style="color:var(--accent);">100 ‚Ç¨</p>
                </div>
                <div class="chest-card" id="chest2" onclick="openChest(2, 1000)">
                    <span class="chest-icon">üöö</span>
                    <h3>Truck Load</h3>
                    <p style="color:var(--accent);">1.000 ‚Ç¨</p>
                </div>
                <div class="chest-card" id="chest3" onclick="openChest(3, 5000)">
                    <span class="chest-icon">üö¢</span>
                    <h3>Container</h3>
                    <p style="color:var(--accent);">5.000 ‚Ç¨</p>
                </div>
            </div>
            <h2 id="lootResult" style="margin-top:40px; height: 50px;"></h2>
        </div>
    </div>

    <div id="view-casino" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Zur√ºck</button><span class="global-cash" style="font-size:1.5em; color:var(--green); font-weight:bold;"></span></div>
        <div style="text-align:center; padding-top:50px;">
            <div id="rouletteWheel" style="font-size: 8em; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);">üé≤</div>
            <br>
            <input type="number" id="betAmount" placeholder="Einsatz" style="padding:15px; font-size:1.5em; text-align:center; width:200px; border-radius:10px; border:none;">
            <br><br>
            <button class="action-btn" style="background:var(--red); color:white; width:150px;" onclick="spin('red')">ROT (x2)</button>
            <button class="action-btn" style="background:#333; color:white; border:1px solid white; width:150px;" onclick="spin('black')">SCHWARZ (x2)</button>
            <br>
            <h2 id="casinoMsg" style="margin-top:20px;"></h2>
        </div>
    </div>

    <div id="view-tycoon" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Zur√ºck</button><span class="global-cash" style="font-size:1.5em; color:var(--green); font-weight:bold;"></span></div>
        <h2 style="text-align:center;">Passives Einkommen: <span id="passiveDisplay">0</span> ‚Ç¨/s</h2>
        <div id="tycoonList" class="tycoon-grid"></div>
    </div>

     <div id="view-heist" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Zur√ºck</button><span class="global-cash" style="font-size:1.5em; color:var(--green); font-weight:bold;"></span></div>
        <div style="max-width:500px; margin:50px auto; background:#222; padding:30px; border-radius:20px; text-align:center; border:4px solid #444;">
            <h1 style="color:var(--red);">SAFE CRACKER</h1>
            <div style="background:#000; color:var(--red); font-family:monospace; font-size:2em; margin-bottom:20px;" id="safeStatus">LOCKED</div>
            <div style="width:100%; height:30px; background:#333; position:relative; overflow:hidden; border-radius:15px;">
                <div id="safeTarget" style="position:absolute; height:100%; background:rgba(0,255,0,0.3); border-left:2px solid lime; border-right:2px solid lime;"></div>
                <div id="safeCursor" style="position:absolute; width:4px; height:100%; background:white; left:0;"></div>
            </div>
            <p>Einsatz: 500 ‚Ç¨</p>
            <button class="action-btn" style="background:var(--red); color:white; width:100%; margin-top:20px;" onclick="tryHeist()">KNACKEN</button>
        </div>
    </div>

    <script>
        // --- CORE SYSTEM ---
        let cash = 10000;
        
        function updateCash(amount) {
            cash += amount;
            // Animation f√ºr alle Geldanzeigen
            document.querySelectorAll('.global-cash, #menuCash').forEach(el => {
                el.innerText = cash.toLocaleString('de-DE', {style:'currency', currency:'EUR'});
                el.classList.remove('cash-pulse');
                void el.offsetWidth; // Trigger Reflow
                el.classList.add('cash-pulse');
            });
            renderTycoon(); // Buttons pr√ºfen
        }

        function openGame(id) {
            document.getElementById('mainMenu').style.display = 'none';
            document.querySelectorAll('.game-view').forEach(v => v.style.display = 'none');
            
            let view = document.getElementById('view-'+id);
            view.style.display = 'block';
            
            // Spezielle Init
            if(id === 'stocks') { setTimeout(() => { if(chart) chart.resize(); }, 100); }
            if(id === 'heist') startHeist();
            
            updateCash(0);
        }

        function goHome() {
            document.querySelectorAll('.game-view').forEach(v => v.style.display = 'none');
            document.getElementById('mainMenu').style.display = 'flex';
            if(heistInterval) clearInterval(heistInterval);
        }

        // --- 1. SYSTEM: AKTIEN (FIXED & ANIMATED) ---
        let stocks = [];
        let selectedStockId = 0;
        let chart;
        const HISTORY_SIZE = 40;

        function initStocks() {
            const names = ["Apple", "Tesla", "Amazon", "Nvidia", "Google", "Microsoft", "Netflix", "Meta", "Ferrari", "Bitcoin"];
            for(let i=0; i<names.length; i++) {
                stocks.push({
                    id: i,
                    name: names[i],
                    price: Math.random() * 200 + 50,
                    history: Array(HISTORY_SIZE).fill(0),
                    owned: 0,
                    trend: 0, // 1=up, -1=down
                    boost: 0
                });
            }
            
            const ctx = document.getElementById('stockChartCanvas').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(HISTORY_SIZE).fill(''),
                    datasets: [{
                        label: 'Price',
                        data: [],
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { grid: { color: '#333' } } },
                    animation: false
                }
            });
            
            renderStockList();
            updateChart();
        }

        // Der Markt-Loop (l√§uft immer im Hintergrund)
        setInterval(() => {
            stocks.forEach(s => {
                let prev = s.price;
                
                if(s.boost > 0) {
                    s.price *= 1.05; // 5% pro Tick bei Boost
                    s.boost--;
                } else {
                    let move = (Math.random() - 0.5) * 4; // Normal fluctuation
                    if(Math.random() > 0.95) move *= 5; // Pl√∂tzlicher Sprung
                    s.price += move;
                }
                
                if(s.price < 1) s.price = 1;
                s.trend = s.price >= prev ? 1 : -1;
                
                s.history.shift();
                s.history.push(s.price);
            });
            
            // Nur UI updaten wenn wir im Aktien Screen sind
            if(document.getElementById('view-stocks').style.display === 'block') {
                renderStockList();
                updateChart();
            }
        }, 1000);

        function renderStockList() {
            let html = '';
            stocks.forEach(s => {
                let colorClass = s.trend > 0 ? 'flash-g' : 'flash-r';
                let priceColor = s.trend > 0 ? 'var(--green)' : 'var(--red)';
                let bg = s.id === selectedStockId ? '#333' : '';
                
                html += `<tr onclick="selectStock(${s.id})" style="background:${bg}">
                    <td style="color:${s.boost>0?'gold':'white'}">${s.name} ${s.boost>0?'üöÄ':''}</td>
                    <td style="color:${priceColor}" class="${colorClass}">${s.price.toFixed(2)} ‚Ç¨</td>
                    <td>${s.owned}</td>
                </tr>`;
            });
            document.getElementById('stockTableBody').innerHTML = html;
        }

        function selectStock(id) {
            selectedStockId = id;
            updateChart();
        }

        function updateChart() {
            let s = stocks[selectedStockId];
            document.getElementById('stockNameDisplay').innerText = s.name;
            document.getElementById('stockPriceDisplay').innerText = s.price.toFixed(2) + " ‚Ç¨";
            document.getElementById('stockPriceDisplay').style.color = s.trend > 0 ? 'var(--green)' : 'var(--red)';
            
            chart.data.datasets[0].data = s.history;
            chart.data.datasets[0].borderColor = s.boost > 0 ? 'gold' : (s.trend > 0 ? '#00ff88' : '#ff3333');
            chart.update();
        }

        function tradeStock(qty) {
            let s = stocks[selectedStockId];
            if(qty > 0) { // Buy
                if(cash >= s.price) { updateCash(-s.price); s.owned++; }
            } else { // Sell
                if(s.owned > 0) { updateCash(s.price); s.owned--; }
            }
            renderStockList();
        }

        function boostStock() {
            stocks[selectedStockId].boost = 15;
        }


        // --- 2. SYSTEM: AUKTIONEN (ANIMATIONEN) ---
        let isOpening = false;
        function openChest(id, cost) {
            if(isOpening || cash < cost) return;
            updateCash(-cost);
            isOpening = true;

            let card = document.getElementById('chest'+id);
            let icon = card.querySelector('.chest-icon');
            
            // 1. Shake Animation
            icon.classList.add('shaking');
            document.getElementById('lootResult').innerText = "√ñffne...";
            
            setTimeout(() => {
                // 2. Result
                icon.classList.remove('shaking');
                let luck = Math.random();
                let multi = 0;
                
                if(luck > 0.9) multi = 4; // Jackpot
                else if(luck > 0.5) multi = 1.2; // Klein Gewinn
                else if(luck > 0.2) multi = 0.5; // Verlust
                else multi = 0; // Niete

                let win = Math.floor(cost * multi);
                updateCash(win);
                
                let resText = document.getElementById('lootResult');
                if(win > cost) {
                    resText.innerHTML = `<span style="color:gold; font-size:1.5em; animation:pop 0.5s">JACKPOT! ${win} ‚Ç¨</span>`;
                    // Confetti Effekt simulieren
                    icon.innerText = "üí∞";
                } else if (win === 0) {
                    resText.innerHTML = `<span style="color:red">M√ºll... (0 ‚Ç¨)</span>`;
                    icon.innerText = "üóëÔ∏è";
                } else {
                    resText.innerText = `Wert: ${win} ‚Ç¨`;
                    icon.innerText = "‚úÖ";
                }

                // Reset nach 2 Sekunden
                setTimeout(() => {
                    isOpening = false;
                    icon.innerText = id===1?"üì¶":(id===2?"üöö":"üö¢");
                    resText.innerText = "";
                }, 2000);

            }, 1000); // 1 Sekunde wackeln
        }


        // --- 3. SYSTEM: CASINO ---
        function spin(choice) {
            let bet = parseInt(document.getElementById('betAmount').value);
            if(!bet || bet > cash) return;
            updateCash(-bet);
            
            let wheel = document.getElementById('rouletteWheel');
            wheel.style.transform = "rotate(720deg) scale(0.5)";
            
            setTimeout(() => {
                let win = Math.random() > 0.5; // 50/50 Chance (vereinfacht)
                wheel.style.transform = "rotate(0deg) scale(1)";
                
                if(win) {
                    updateCash(bet * 2);
                    document.getElementById('casinoMsg').innerText = "GEWONNEN!";
                    document.getElementById('casinoMsg').style.color = "lime";
                } else {
                    document.getElementById('casinoMsg').innerText = "Verloren...";
                    document.getElementById('casinoMsg').style.color = "red";
                }
            }, 500);
        }

        // --- 4. SYSTEM: TYCOON ---
        let buildings = [
            {id:0, name:"Kiosk", cost:100, inc:1, count:0},
            {id:1, name:"Wohnung", cost:1000, inc:12, count:0},
            {id:2, name:"Fabrik", cost:10000, inc:150, count:0},
            {id:3, name:"Bank", cost:100000, inc:1600, count:0}
        ];

        function renderTycoon() {
            let html = "";
            let totalInc = 0;
            buildings.forEach(b => {
                totalInc += b.count * b.inc;
                let currentCost = Math.floor(b.cost * Math.pow(1.15, b.count));
                let canBuy = cash >= currentCost;
                html += `
                <div class="building-card" onclick="${canBuy ? 'buyBuilding('+b.id+')' : ''}" style="opacity:${canBuy?1:0.5}; cursor:${canBuy?'pointer':'not-allowed'}">
                    <h3>${b.name} <span style="float:right">x${b.count}</span></h3>
                    <div style="color:var(--green)">+${b.inc}‚Ç¨/s</div>
                    <div style="margin-top:5px; font-weight:bold; color:${canBuy?'white':'#555'}">Preis: ${currentCost.toLocaleString()} ‚Ç¨</div>
                </div>`;
            });
            document.getElementById('tycoonList').innerHTML = html;
            document.getElementById('passiveDisplay').innerText = totalInc;
        }

        function buyBuilding(id) {
            let b = buildings[id];
            let cost = Math.floor(b.cost * Math.pow(1.15, b.count));
            if(cash >= cost) {
                updateCash(-cost);
                b.count++;
                renderTycoon();
            }
        }

        setInterval(() => {
            let inc = 0;
            buildings.forEach(b => inc += b.count * b.inc);
            if(inc > 0) updateCash(inc);
        }, 1000);

        // --- 5. SYSTEM: HEIST ---
        let heistInterval, hCursor=0, hDir=1, hTarget=40, hWidth=20;
        function startHeist() {
            if(heistInterval) clearInterval(heistInterval);
            hTarget = Math.random() * 80;
            hWidth = 10 + Math.random() * 10;
            document.getElementById('safeTarget').style.left = hTarget+"%";
            document.getElementById('safeTarget').style.width = hWidth+"%";
            document.getElementById('safeStatus').innerText = "LOCKED";
            document.getElementById('safeStatus').style.color = "red";
            
            heistInterval = setInterval(() => {
                hCursor += 1.5 * hDir;
                if(hCursor > 100 || hCursor < 0) hDir *= -1;
                document.getElementById('safeCursor').style.left = hCursor+"%";
            }, 10);
        }
        function tryHeist() {
            if(cash < 500) return;
            updateCash(-500);
            if(hCursor >= hTarget && hCursor <= hTarget+hWidth) {
                let loot = 2000 + Math.floor(Math.random()*3000);
                updateCash(loot);
                document.getElementById('safeStatus').innerText = "OPEN: +"+loot+"‚Ç¨";
                document.getElementById('safeStatus').style.color = "lime";
            } else {
                document.getElementById('safeStatus').innerText = "ALARM!";
            }
        }

        // INIT
        initStocks();
        updateCash(0);

    </script>
</body>
</html>
