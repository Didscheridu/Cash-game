<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Mogul Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --accent: #38bdf8;
            --green: #22c55e;
            --red: #ef4444;
            --gold: #eab308;
            --text: #f8fafc;
        }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            padding: 0;
            user-select: none;
            overflow: hidden; 
        }

        /* --- UI ELEMENTS --- */
        .game-view { display: none; height: 100vh; box-sizing: border-box; padding: 20px; max-width: 1200px; margin: 0 auto; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--bg-panel); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #334155; }
        .back-btn { background: #334155; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        button { cursor: pointer; transition: 0.2s; border: none; }
        button:active { transform: scale(0.95); }
        input { background: #0f172a; border: 1px solid #334155; color: white; border-radius: 5px; text-align: center; padding: 8px; }

        /* --- MENU --- */
        #mainMenu { display: flex; flex-direction: column; align-items: center; height: 100vh; padding-top: 50px; background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 800px; width: 100%; }
        .menu-card { background: var(--bg-panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid #334155; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .menu-card:hover { transform: translateY(-5px); border-color: var(--accent); }

        /* --- REAL ESTATE --- */
        .estate-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { background: #334155; color: #94a3b8; padding: 10px 20px; border-radius: 8px; flex: 1; font-weight: bold; }
        .tab-btn.active { background: var(--accent); color: #000; }
        .estate-section { display: none; }
        .estate-section.active { display: block; }

        .property-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .property-card { background: var(--bg-panel); border: 1px solid #334155; border-radius: 10px; padding: 15px; position: relative; overflow: hidden; }
        .prop-icon { font-size: 3em; float: right; opacity: 0.2; }
        .prop-status { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-bottom: 10px; font-weight: bold; }
        .status-empty { background: #334155; color: #94a3b8; }
        .status-occupied { background: rgba(34, 197, 94, 0.2); color: var(--green); border: 1px solid var(--green); }
        .status-robbed { background: rgba(239, 68, 68, 0.2); color: var(--red); border: 1px solid var(--red); animation: shake 0.5s; }

        /* NEGOTIATION MODAL */
        #negotiateModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-content { background: var(--bg-panel); padding: 30px; border-radius: 15px; border: 1px solid var(--accent); text-align: center; max-width: 400px; width: 90%; }
        
        /* NOTIFICATIONS */
        #notificationArea { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 999; }
        .notif { background: #1e293b; border-left: 4px solid var(--accent); padding: 15px; border-radius: 5px; color: white; width: 300px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: slideIn 0.3s; }
        .notif-bad { border-color: var(--red); }
        .notif-good { border-color: var(--green); }

        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes shake { 0% { transform: translate(0,0); } 25% { transform: translate(-5px, 0); } 75% { transform: translate(5px, 0); } 100% { transform: translate(0,0); } }

        /* STOCK & CASINO STYLES (Keeping simplified for length) */
        .stock-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 85vh; }
        .stock-list-container { overflow-y: auto; background: var(--bg-panel); border-radius: 12px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #334155; text-align: left; }
        tr:hover { background: #334155; cursor: pointer; }
        .btn-action { width: 100%; padding: 10px; border-radius: 5px; font-weight: bold; margin-top: 5px; }

    </style>
</head>
<body>

    <div id="notificationArea"></div>

    <div id="negotiateModal">
        <div class="modal-content">
            <h2>Mietvertrag aushandeln</h2>
            <p>Objekt: <span id="negName" style="color:var(--accent)"></span></p>
            <p>Marktwert: <span id="negMarket"></span> ‚Ç¨ / Monat</p>
            <hr style="border-color:#334155; margin: 20px 0;">
            <label>Deine Forderung:</label>
            <input type="number" id="negOffer" style="font-size: 1.5em; width: 150px; display:block; margin: 10px auto;">
            <button class="btn-action" style="background:var(--green); color:black;" onclick="submitOffer()">Angebot senden</button>
            <button class="btn-action" style="background:#334155; color:white;" onclick="closeModal()">Abbrechen</button>
            <p id="negResult" style="height: 20px; font-weight: bold; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="mainMenu">
        <h1 style="color:var(--accent); font-size: 3em; margin-bottom: 10px;">BUSINESS MOGUL</h1>
        <h2 style="color:var(--green); margin-bottom: 50px;" id="menuCash">10.000 ‚Ç¨</h2>
        
        <div class="menu-grid">
            <div class="menu-card" onclick="openGame('stocks')">
                <div style="font-size: 4em;">üìà</div>
                <h2>Aktienmarkt</h2>
                <p style="color:#94a3b8">Profi Charts & IPOs</p>
            </div>
            <div class="menu-card" onclick="openGame('realestate')">
                <div style="font-size: 4em;">üèôÔ∏è</div>
                <h2>Immobilien & Business</h2>
                <p style="color:#94a3b8">Vermietung, √úberf√§lle, Startups</p>
            </div>
            <div class="menu-card" onclick="openGame('casino')">
                <div style="font-size: 4em;">üé∞</div>
                <h2>Casino</h2>
                <p style="color:#94a3b8">Slots & Roulette</p>
            </div>
        </div>
    </div>

    <div id="view-stocks" class="game-view">
        <div class="top-bar">
            <button class="back-btn" onclick="goHome()">üè† Dashboard</button>
            <span class="global-cash" style="color:var(--green); font-size:1.2em; font-family:monospace;"></span>
        </div>
        <div class="stock-layout">
            <div class="stock-list-container">
                <table><thead><tr><th>Aktie</th><th>Kurs</th><th>Besitz</th></tr></thead><tbody id="stockTableBody"></tbody></table>
            </div>
            <div style="background: var(--bg-panel); padding: 20px; border-radius: 12px; display: flex; flex-direction: column;">
                <h2 id="stockNameDisplay" style="margin:0">W√§hle Aktie</h2>
                <h2 id="stockPriceDisplay" style="margin:0; font-family: monospace;">--</h2>
                <div style="flex-grow:1; position:relative;"><canvas id="stockChartCanvas"></canvas></div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input type="number" id="stockInput" value="10" style="flex:1">
                    <button class="btn-action" style="flex:1; background:var(--green)" onclick="tradeStock('buy')">Kaufen</button>
                    <button class="btn-action" style="flex:1; background:var(--red); color:white" onclick="tradeStock('sell')">Verkaufen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-realestate" class="game-view">
        <div class="top-bar">
            <button class="back-btn" onclick="goHome()">üè† Dashboard</button>
            <span class="global-cash" style="color:var(--green); font-size:1.2em; font-family:monospace;"></span>
        </div>

        <div class="estate-tabs">
            <button class="tab-btn active" onclick="switchTab('buy')">üõí Kaufen</button>
            <button class="tab-btn" onclick="switchTab('manage')">üîë Meine Objekte</button>
            <button class="tab-btn" onclick="switchTab('found')">üöÄ Startup Gr√ºnden</button>
        </div>

        <div id="tab-buy" class="estate-section active">
            <h2>Verf√ºgbare Objekte</h2>
            <div class="property-grid" id="buyList"></div>
        </div>

        <div id="tab-manage" class="estate-section">
            <h2>Mein Portfolio</h2>
            <p style="color:#94a3b8">Mieteinnahmen kommen automatisch jede Minute.</p>
            <div class="property-grid" id="myList">
                <p style="padding:20px; color:#666">Du besitzt noch keine Immobilien.</p>
            </div>
        </div>

        <div id="tab-found" class="estate-section">
            <div style="max-width:500px; margin: 0 auto; background:var(--bg-panel); padding:40px; border-radius:20px; text-align:center; border: 1px solid var(--accent);">
                <h1 style="font-size:4em">ü¶Ñ</h1>
                <h2>Gr√ºnde dein eigenes Unternehmen</h2>
                <p>Dein Unternehmen wird an die B√∂rse gehen (IPO). Du erh√§ltst 100% der Aktien.</p>
                <br>
                <input type="text" id="companyName" placeholder="Firmenname (z.B. NovaTech)" style="width:100%; font-size:1.2em; padding:15px; margin-bottom:10px;">
                <input type="text" id="companyTicker" placeholder="K√ºrzel (z.B. NOVA)" style="width:100%; font-size:1.2em; padding:15px; margin-bottom:20px; text-transform:uppercase;">
                
                <p style="color:var(--gold)">Gr√ºndungskosten: 50.000 ‚Ç¨</p>
                <button class="btn-action" style="background:var(--accent); color:black; font-size:1.2em;" onclick="foundCompany()">Jetzt Gr√ºnden üöÄ</button>
            </div>
        </div>
    </div>

    <div id="view-casino" class="game-view">
        <div class="top-bar"><button class="back-btn" onclick="goHome()">üè† Home</button><span class="global-cash"></span></div>
        <div style="text-align:center; margin-top:50px">
            <h1>üé∞</h1>
            <input type="number" id="betAmount" placeholder="Einsatz" style="font-size:1.5em; width:200px;">
            <br><br>
            <button class="btn-action" style="background:var(--red); width:200px; color:white;" onclick="spin()">Rot/Schwarz (50%)</button>
        </div>
    </div>

    <script>
        // --- CORE ---
        let cash = 60000; // Startkapital erh√∂ht f√ºr Immobilien
        let myProperties = [];
        let stocks = [
            { id: 0, name: "Apple Inc.", ticker: "AAPL", price: 180, history: [], owned: 0 },
            { id: 1, name: "Tesla", ticker: "TSLA", price: 240, history: [], owned: 0 },
            { id: 2, name: "Amazon", ticker: "AMZN", price: 140, history: [], owned: 0 }
        ];
        
        // Datenbank der kaufbaren Geb√§ude
        const propertyDB = [
            { id: 0, type: "residential", name: "Kleine Wohnung", cost: 5000, marketRent: 300, icon: "üè†" },
            { id: 1, type: "residential", name: "Penthouse", cost: 25000, marketRent: 1500, icon: "üè¢" },
            { id: 2, type: "commercial", name: "Kiosk", cost: 10000, marketRent: 800, icon: "üè™" }, // Gewerbe bringt mehr Geld, aber Risiko
            { id: 3, type: "commercial", name: "Tankstelle", cost: 80000, marketRent: 5000, icon: "‚õΩ" }
        ];

        function formatMoney(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function updateUI() {
            document.getElementById('menuCash').innerText = formatMoney(cash);
            document.querySelectorAll('.global-cash').forEach(e => e.innerText = formatMoney(cash));
        }
        function goHome() { document.querySelectorAll('.game-view').forEach(e => e.style.display='none'); document.getElementById('mainMenu').style.display='flex'; }
        function openGame(id) { 
            document.getElementById('mainMenu').style.display='none'; 
            document.getElementById('view-'+id).style.display='block'; 
            if(id==='stocks') resizeChart();
            if(id==='realestate') renderRealEstate();
        }

        // --- REAL ESTATE SYSTEM ---
        function switchTab(tab) {
            document.querySelectorAll('.estate-section').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active');
            event.target.classList.add('active');
            renderRealEstate();
        }

        function renderRealEstate() {
            // Render Buy List
            let buyHtml = "";
            propertyDB.forEach(p => {
                buyHtml += `
                <div class="property-card">
                    <span class="prop-icon">${p.icon}</span>
                    <h3>${p.name}</h3>
                    <p style="color:#94a3b8">Typ: ${p.type === 'residential' ? 'Wohnung' : 'Gewerbe (Risiko!)'}</p>
                    <p style="color:var(--green)">Potenzielle Miete: ~${p.marketRent} ‚Ç¨</p>
                    <button class="btn-action" style="background:var(--accent); color:black" onclick="buyProperty(${p.id})">Kaufen (${formatMoney(p.cost)})</button>
                </div>`;
            });
            document.getElementById('buyList').innerHTML = buyHtml;

            // Render My Properties
            let myHtml = "";
            if(myProperties.length === 0) myHtml = "<p style='padding:20px; color:#666'>Keine Immobilien.</p>";
            
            myProperties.forEach((p, index) => {
                let statusHtml = "";
                let actionHtml = "";

                if(p.tenant) {
                    statusHtml = `<span class="prop-status status-occupied">Vermietet: ${p.rent} ‚Ç¨</span>`;
                    actionHtml = `<button class="btn-action" style="background:#334155; color:white" onclick="kickTenant(${index})">Mieter k√ºndigen</button>`;
                } else {
                    statusHtml = `<span class="prop-status status-empty">Leerstehend</span>`;
                    actionHtml = `<button class="btn-action" style="background:var(--green); color:black" onclick="openNegotiation(${index})">Mieter suchen</button>`;
                }

                myHtml += `
                <div class="property-card" id="prop-card-${index}">
                    <span class="prop-icon">${p.icon}</span>
                    <h3>${p.name} #${index+1}</h3>
                    ${statusHtml}
                    ${actionHtml}
                </div>`;
            });
            document.getElementById('myList').innerHTML = myHtml;
        }

        function buyProperty(dbId) {
            let p = propertyDB[dbId];
            if(cash < p.cost) return showNotification("Zu wenig Geld!", "bad");
            cash -= p.cost;
            // Objekt instanzieren
            myProperties.push({
                ...p,
                tenant: false,
                rent: 0,
                lastRobbery: 0
            });
            updateUI();
            showNotification(p.name + " gekauft!", "good");
            renderRealEstate();
        }

        // --- VERHANDLUNG ---
        let currentNegIndex = -1;

        function openNegotiation(index) {
            currentNegIndex = index;
            let p = myProperties[index];
            document.getElementById('negotiateModal').style.display = 'flex';
            document.getElementById('negName').innerText = p.name;
            document.getElementById('negMarket').innerText = p.marketRent;
            document.getElementById('negOffer').value = p.marketRent; // Startvorschlag
            document.getElementById('negResult').innerText = "";
        }

        function closeModal() { document.getElementById('negotiateModal').style.display = 'none'; }

        function submitOffer() {
            let offer = parseInt(document.getElementById('negOffer').value);
            let p = myProperties[currentNegIndex];
            let resDisplay = document.getElementById('negResult');

            if(!offer || offer <= 0) return;

            // Logik: Je h√∂her √ºber Marktwert, desto unwahrscheinlicher
            let ratio = p.marketRent / offer; // z.B. Wert 1000, Angebot 1000 -> 1.0 (100%). Angebot 2000 -> 0.5 (50%)
            // Bonus f√ºr Gewerbe ist etwas toleranter
            if(p.type === 'commercial') ratio *= 1.1;

            if(Math.random() < ratio) {
                // Erfolg
                p.tenant = true;
                p.rent = offer;
                resDisplay.style.color = "var(--green)";
                resDisplay.innerText = "Akzeptiert! Vertrag unterschrieben.";
                setTimeout(() => {
                    closeModal();
                    renderRealEstate();
                }, 1000);
            } else {
                // Fehlschlag
                resDisplay.style.color = "var(--red)";
                resDisplay.innerText = "Mieter: 'Zu teuer! Ich gehe.'";
            }
        }

        function kickTenant(index) {
            myProperties[index].tenant = false;
            myProperties[index].rent = 0;
            renderRealEstate();
        }

        // --- STARTUP GR√úNDEN ---
        function foundCompany() {
            let name = document.getElementById('companyName').value;
            let ticker = document.getElementById('companyTicker').value.toUpperCase();
            if(!name || !ticker) return alert("Bitte Namen eingeben");
            if(cash < 50000) return showNotification("Du brauchst 50.000 ‚Ç¨", "bad");

            cash -= 50000;
            
            // Neue Aktie erstellen
            let newStock = {
                id: stocks.length,
                name: name,
                ticker: ticker,
                price: 10, // Startpreis
                history: [],
                owned: 10000 // Du startest mit vielen Aktien (100% Besitz)
            };
            
            // Geschichte f√ºllen
            for(let i=0; i<20; i++) newStock.history.push(10);
            
            stocks.push(newStock);
            
            updateUI();
            showNotification(`Firma ${name} gegr√ºndet & an der B√∂rse gelistet!`, "good");
            document.getElementById('companyName').value = "";
            document.getElementById('companyTicker').value = "";
            
            // Automatisch zum Aktienmarkt wechseln
            openGame('stocks');
        }

        // --- GAME LOOP (Miete & Events) ---
        setInterval(() => {
            // Miete einsammeln (Jede Minute simuliert, hier alle 10s f√ºr Gameplay Speed)
            let totalRent = 0;
            myProperties.forEach((p, idx) => {
                if(p.tenant) {
                    // √úberfall Logik f√ºr Gewerbe
                    if(p.type === 'commercial' && Math.random() < 0.05) { // 5% Chance pro Zyklus
                        showNotification(`üî• √úBERFALL im ${p.name}! Einnahmen gestohlen.`, "bad");
                        // Visueller Effekt
                        let card = document.getElementById('prop-card-'+idx);
                        if(card) card.classList.add('status-robbed');
                        setTimeout(() => { if(card) card.classList.remove('status-robbed'); }, 2000);
                    } else {
                        totalRent += p.rent;
                    }
                }
            });

            if(totalRent > 0) {
                cash += totalRent;
                updateUI();
                // Wenn wir im Tab Manage sind, zeige es an
                if(document.getElementById('tab-manage').classList.contains('active')) {
                   // Optional: Kleiner Float text
                }
            }
        }, 10000); // Zahltag alle 10 Sekunden (statt Minute, damit es Spa√ü macht)

        // --- HELPER: NOTIFICATIONS ---
        function showNotification(msg, type) {
            let div = document.createElement('div');
            div.className = `notif notif-${type}`;
            div.innerText = msg;
            document.getElementById('notificationArea').appendChild(div);
            setTimeout(() => div.remove(), 3000);
        }

        // --- STOCK CHART LOGIC (Standard aus vorherigen Versionen) ---
        let selectedStockId = 0;
        let chart;
        function initChart() {
            const ctx = document.getElementById('stockChartCanvas').getContext('2d');
            chart = new Chart(ctx, { type: 'line', data: { labels: Array(20).fill(''), datasets: [{ data: [], borderColor: '#38bdf8', tension: 0.3, pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: {legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}} } });
        }
        function resizeChart() { setTimeout(()=>chart.resize(),100); }
        
        // Market Tick (Alle 2s)
        setInterval(() => {
            stocks.forEach(s => {
                let change = (Math.random()-0.5) * (s.price * 0.1); 
                s.price += change; 
                if(s.price<1) s.price=1;
                s.history.shift(); s.history.push(s.price);
            });
            if(document.getElementById('view-stocks').style.display==='block') {
                renderStockList(); updateChart();
            }
        }, 2000);

        function renderStockList() {
            let h=""; 
            stocks.forEach(s => h+=`<tr onclick="selStock(${s.id})"><td><b>${s.ticker}</b></td><td>${s.price.toFixed(2)}‚Ç¨</td><td>${s.owned}</td></tr>`);
            document.getElementById('stockTableBody').innerHTML=h;
        }
        function selStock(id){ selectedStockId=id; updateChart(); }
        function updateChart(){
            let s=stocks[selectedStockId];
            document.getElementById('stockNameDisplay').innerText=s.name;
            document.getElementById('stockPriceDisplay').innerText=s.price.toFixed(2)+"‚Ç¨";
            chart.data.datasets[0].data=s.history; chart.update('none');
        }
        function tradeStock(type){
            let qty=parseInt(document.getElementById('stockInput').value);
            let s=stocks[selectedStockId];
            if(type==='buy' && cash>=s.price*qty){cash-=s.price*qty; s.owned+=qty;}
            if(type==='sell' && s.owned>=qty){cash+=s.price*qty; s.owned-=qty;}
            updateUI();
        }

        // Casino Simpel
        function spin() {
            let b=parseInt(document.getElementById('betAmount').value);
            if(b && cash>=b) { cash-=b; if(Math.random()>0.5){cash+=b*2; alert("Gewonnen!");}else{alert("Verloren");} updateUI(); }
        }

        // INIT
        stocks.forEach(s => { for(let i=0;i<20;i++) s.history.push(s.price); });
        initChart();
        updateUI();

    </script>
</body>
</html>
