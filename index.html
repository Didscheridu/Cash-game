<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Ultimate</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0f172a; --panel: #1e293b; --border: #334155;
            --accent: #38bdf8; --green: #22c55e; --red: #ef4444; --gold: #eab308; --purple: #d946ef;
            --text: #f8fafc;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; user-select: none; }
        
        /* ANIMATIONS */
        @keyframes pop { 0% { transform: scale(0); opacity:0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity:1; } }
        @keyframes slide { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
        @keyframes spin { 0% { transform: translateY(-100%); } 100% { transform: translateY(0); } }

        /* LAYOUT */
        .view { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; max-width: 1400px; margin: 0 auto; }
        .view.active { display: block; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--panel); padding: 15px; border-radius: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .btn { background: var(--border); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-green { background: var(--green); color: black; }
        .btn-red { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-accent { background: var(--accent); color: black; }
        
        input { background: var(--bg); border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; text-align: center; }

        /* MENU */
        #menu { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1e293b 0%, #0f172a 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 800px; width: 100%; padding: 20px; }
        .card { background: var(--panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

        /* STOCK MARKET */
        .stock-grid { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 80vh; }
        .list-panel { background: var(--panel); border-radius: 12px; overflow-y: auto; border: 1px solid var(--border); }
        .detail-panel { background: var(--panel); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        tr:hover { background: var(--border); cursor: pointer; }
        .sig-buy { color: var(--green); background: rgba(34, 197, 94, 0.1); padding: 2px 5px; border-radius: 4px; font-size: 0.8em; }
        .sig-sell { color: var(--red); background: rgba(239, 68, 68, 0.1); padding: 2px 5px; border-radius: 4px; font-size: 0.8em; }
        
        .hacker-panel { margin-top: 15px; padding: 15px; background: #2a1515; border: 1px solid #4a2020; border-radius: 8px; }
        .bot-active { animation: pulse 1s infinite; border-color: var(--accent); color: var(--accent); }

        /* REAL ESTATE & JOBS */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; background: var(--panel); border: 1px solid var(--border); color: #888; cursor: pointer; text-align: center; border-radius: 6px; font-weight: bold; }
        .tab.active { background: var(--accent); color: black; }
        .section { display: none; }
        .section.active { display: block; }
        
        .grid-box { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .item-card { background: var(--panel); padding: 15px; border-radius: 10px; border: 1px solid var(--border); position: relative; }
        .status-badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; margin: 5px 0; }
        .st-empty { background: #333; color: #aaa; }
        .st-rented { background: rgba(34, 197, 94, 0.2); color: var(--green); }

        /* JOBS PROGRESS */
        .job-bar-bg { background: #333; height: 10px; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        .job-bar-fill { background: var(--accent); height: 100%; width: 0%; transition: width 0.1s linear; }

        /* NOTIFICATIONS */
        #notif-area { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .notif { background: rgba(15, 23, 42, 0.95); border-left: 4px solid var(--accent); padding: 15px; width: 300px; color: white; border-radius: 4px; animation: slide 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-box { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--accent); width: 90%; max-width: 400px; text-align: center; }

    </style>
</head>
<body>

    <div id="notif-area"></div>

    <div id="modal-neg" class="modal">
        <div class="modal-box">
            <h2>Mietpreis festlegen</h2>
            <p>Marktwert: <span id="neg-market" style="color:var(--accent)"></span> ‚Ç¨</p>
            <input type="number" id="neg-input" placeholder="Deine Forderung" style="font-size:1.5em; width:80%; margin:15px 0;">
            <div style="display:flex; gap:10px;">
                <button class="btn btn-green" style="flex:1" onclick="submitRent()">Angebot senden</button>
                <button class="btn" style="flex:1" onclick="closeModals()">Abbrechen</button>
            </div>
        </div>
    </div>

    <div id="modal-loot" class="modal">
        <div class="modal-box">
            <h2 id="loot-title">√ñffne...</h2>
            <div id="loot-content" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0;"></div>
            <button class="btn btn-green" onclick="closeModals()">OK</button>
        </div>
    </div>

    <div id="menu">
        <h1 style="color:var(--accent); font-size:3em; margin:0;">BUSINESS ULTIMATE</h1>
        <h2 style="color:var(--green); font-family:monospace; font-size:2.5em; margin-bottom:40px;" class="display-cash">10.000 ‚Ç¨</h2>
        <div class="menu-grid">
            <div class="card" onclick="nav('stocks')"><h1>üìà</h1><h2>Wall Street</h2><p style="color:#888">Charts, Bot & Manipulation</p></div>
            <div class="card" onclick="nav('biz')"><h1>üèôÔ∏è</h1><h2>Business & Karriere</h2><p style="color:#888">Immobilien, Startups, Jobs</p></div>
            <div class="card" onclick="nav('loot')"><h1>üéí</h1><h2>Auktionen</h2><p style="color:#888">Inventar & Handel</p></div>
            <div class="card" onclick="nav('casino')"><h1>üé∞</h1><h2>Casino</h2><p style="color:#888">Slots & Roulette</p></div>
        </div>
    </div>

    <div id="view-stocks" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.2em; font-family:monospace; color:var(--green)"></span>
        </div>
        <div class="stock-grid">
            <div class="list-panel">
                <table><thead><tr><th>Aktie</th><th>Kurs</th><th>Signal</th><th>Besitz</th></tr></thead><tbody id="stock-list"></tbody></table>
            </div>
            <div class="detail-panel">
                <div style="display:flex; justify-content:space-between;">
                    <h2 id="st-name" style="margin:0">Apple</h2>
                    <h2 id="st-price" style="margin:0; font-family:monospace">150.00 ‚Ç¨</h2>
                </div>
                <div style="flex:1; position:relative; min-height:250px;"><canvas id="chart"></canvas></div>
                
                <div class="hacker-panel">
                    <div style="color:var(--red); font-weight:bold; font-family:monospace; margin-bottom:5px;">‚ö†Ô∏è MARKT-MANIPULATOR</div>
                    <div style="display:flex; gap:5px;">
                        <input id="hack-target" placeholder="Zielpreis ‚Ç¨" type="number" style="flex:1">
                        <input id="hack-time" placeholder="Sekunden" type="number" style="width:80px" value="10">
                        <button class="btn btn-red" onclick="startHack()">üöÄ</button>
                    </div>
                </div>

                <div style="margin-top:15px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <input id="st-qty" type="number" value="10" style="grid-column:span 2">
                    <button class="btn btn-green" onclick="trade('buy')">Kaufen</button>
                    <button class="btn btn-red" onclick="trade('sell')">Verkaufen</button>
                    <button id="btn-bot" class="btn" style="grid-column:span 2; border:1px solid var(--accent)" onclick="toggleBot()">ü§ñ Auto-Trader Bot</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-biz" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.2em; font-family:monospace; color:var(--green)"></span>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="tab('biz', 'estate')">Immobilien</div>
            <div class="tab" onclick="tab('biz', 'jobs')">Karriere & Jobs</div>
            <div class="tab" onclick="tab('biz', 'found')">Startup Gr√ºnden</div>
        </div>

        <div id="tab-estate" class="section active">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h2>Immobilienmarkt</h2>
                <div style="text-align:right">N√§chste Miete: <span id="rent-timer" style="color:var(--accent)">10s</span></div>
            </div>
            <div id="estate-list" class="grid-box"></div>
            <hr style="border-color:var(--border); margin:20px 0;">
            <h2>Mein Portfolio</h2>
            <div id="my-estate-list" class="grid-box"></div>
        </div>

        <div id="tab-jobs" class="section">
            <h2>Aktive Arbeit</h2>
            <div class="grid-box">
                <div class="item-card">
                    <h3>üíª Freelancer</h3>
                    <p>Webseiten programmieren</p>
                    <div class="job-bar-bg"><div id="job-1-bar" class="job-bar-fill"></div></div>
                    <button class="btn btn-accent" style="width:100%" onmousedown="workJob(1)">Arbeiten (+250‚Ç¨)</button>
                </div>
                <div class="item-card">
                    <h3>üé® Designer</h3>
                    <p>Logos entwerfen</p>
                    <div class="job-bar-bg"><div id="job-2-bar" class="job-bar-fill"></div></div>
                    <button class="btn btn-accent" style="width:100%" onmousedown="workJob(2)">Arbeiten (+500‚Ç¨)</button>
                </div>
            </div>
        </div>

        <div id="tab-found" class="section">
            <div class="item-card" style="max-width:500px; margin:0 auto; text-align:center; padding:40px;">
                <div style="font-size:4em">ü¶Ñ</div>
                <h2>B√∂rsengang (IPO)</h2>
                <input id="ipo-name" placeholder="Firmenname" style="width:100%; margin-bottom:10px;">
                <input id="ipo-ticker" placeholder="K√ºrzel (z.B. TSLA)" style="width:100%; margin-bottom:10px; text-transform:uppercase;">
                <input id="ipo-shares" type="number" placeholder="Anzahl Aktien" style="width:100%; margin-bottom:20px;">
                <p style="color:var(--gold)">Kosten: 50.000 ‚Ç¨</p>
                <button class="btn btn-green" style="font-size:1.2em; width:100%" onclick="createCompany()">Firma gr√ºnden</button>
            </div>
        </div>
    </div>

    <div id="view-loot" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div class="grid-box" style="margin-bottom:20px;">
            <div class="item-card" onclick="buyLoot(200)"><h1>üì¶</h1><h3>Box (200‚Ç¨)</h3></div>
            <div class="item-card" onclick="buyLoot(1500)"><h1>üöö</h1><h3>Truck (1.5k)</h3></div>
            <div class="item-card" onclick="buyLoot(8000)"><h1>üö¢</h1><h3>Container (8k)</h3></div>
        </div>
        <h2>Inventar <small id="inv-count"></small></h2>
        <button class="btn" onclick="sellAllLoot()">Alles verkaufen</button>
        <div id="inv-list" class="grid-box" style="margin-top:10px;"></div>
    </div>

    <div id="view-casino" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div class="tabs">
            <div class="tab active" onclick="tab('casino', 'roulette')">Roulette</div>
            <div class="tab" onclick="tab('casino', 'slots')">Slots</div>
        </div>
        
        <div id="tab-roulette" class="section active" style="text-align:center;">
            <div id="roulette-wheel" style="font-size:6em; margin:20px; transition:1s;">üé≤</div>
            <input id="roul-bet" type="number" placeholder="Einsatz" style="font-size:1.5em; width:200px;">
            <br><br>
            <button class="btn btn-red" onclick="spinRoulette('red')">Rot</button>
            <button class="btn" style="background:black" onclick="spinRoulette('black')">Schwarz</button>
        </div>

        <div id="tab-slots" class="section" style="text-align:center;">
            <div style="font-size:4em; margin:20px; background:black; padding:20px; border-radius:10px; border:2px solid var(--gold); display:inline-block;">
                <span id="slot1">üçí</span> <span id="slot2">üçí</span> <span id="slot3">üçí</span>
            </div>
            <br>
            <p>Einsatz: 100‚Ç¨</p>
            <button class="btn btn-gold" style="font-size:1.5em; padding:10px 40px;" onclick="spinSlots()">SPIN</button>
        </div>
    </div>

    <script>
        // --- CORE STATE ---
        let cash = 10000;
        let inventory = [];
        let myProperties = [];
        let rentTimer = 15; // Sekunden bis Miete
        let botActive = false;
        let stocks = [
            { id:0, name:"TechGiant", ticker:"TECH", price:150, base:150, hist:Array(40).fill(150), owned:0, hack:{active:false} },
            { id:1, name:"Banana", ticker:"BAN", price:80, base:80, hist:Array(40).fill(80), owned:0, hack:{active:false} },
            { id:2, name:"MarsExpress", ticker:"MARS", price:300, base:300, hist:Array(40).fill(300), owned:0, hack:{active:false} }
        ];
        let selectedStockId = 0;
        let chart;

        // DBs
        const propsDB = [
            {name:"Wohnung", cost:5000, market:300, icon:"üè†", type:"res"},
            {name:"Kiosk", cost:15000, market:1200, icon:"üè™", type:"com"},
            {name:"Fabrik", cost:100000, market:8000, icon:"üè≠", type:"com"}
        ];
        const itemsDB = [
            {n:"Socke",v:5,i:"üß¶"},{n:"Toaster",v:30,i:"üçû"},{n:"Laptop",v:800,i:"üíª"},
            {n:"Rolex",v:5000,i:"‚åö"},{n:"Gold",v:10000,i:"ü•á"},{n:"Diamant",v:50000,i:"üíé"}
        ];

        // --- NAVIGATION ---
        function nav(viewId) {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
            document.getElementById('menu').style.display = viewId==='menu'?'flex':'none';
            if(viewId!=='menu') {
                document.getElementById('view-'+viewId).classList.add('active');
                if(viewId==='stocks') setTimeout(()=>chart.resize(),100);
            }
        }
        function tab(ctx, tabName) {
            document.querySelectorAll(`#view-${ctx} .section`).forEach(e => e.classList.remove('active'));
            document.querySelectorAll(`#view-${ctx} .tab`).forEach(e => e.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
        }
        function closeModals() { document.querySelectorAll('.modal').forEach(e=>e.style.display='none'); }

        // --- UTIL ---
        function fmt(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function notify(msg, type='good') {
            let n = document.createElement('div'); n.className='notif'; n.innerText=msg; 
            n.style.borderColor = type==='bad' ? 'var(--red)' : 'var(--accent)';
            document.getElementById('notif-area').appendChild(n);
            setTimeout(()=>n.remove(), 3000);
        }
        function ui() {
            document.querySelectorAll('.display-cash').forEach(e=>e.innerText=fmt(cash));
            renderStocks(); renderEstate(); renderInv();
        }

        // --- STOCKS ---
        const ctx = document.getElementById('chart').getContext('2d');
        chart = new Chart(ctx, { type:'line', data:{labels:Array(40).fill(''), datasets:[{data:[], borderColor:'#38bdf8', tension:0.1, pointRadius:0}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}}} });

        setInterval(() => { // Market Tick 1s
            stocks.forEach(s => {
                if(s.hack.active) { // Hacking Logic
                    s.hack.tick++; let prog = s.hack.tick/s.hack.duration;
                    if(prog>=1) { s.price=s.hack.target; s.hack.active=false; notify(`${s.name} Ziel erreicht!`); }
                    else { s.price = s.hack.start + (s.hack.target-s.hack.start)*prog + (Math.random()-0.5)*10; } // Lerp + Noise
                } else { // Normal Market
                    s.price += (Math.random()-0.5)*(s.price*0.05); 
                    // Mean reversion
                    s.price += (s.base - s.price)*0.02; 
                }
                if(s.price<1) s.price=1;
                s.hist.shift(); s.hist.push(s.price);
            });
            if(document.getElementById('view-stocks').classList.contains('active')) updateChart();
            if(botActive) runBot();
        }, 1000);

        function renderStocks() {
            let t = document.getElementById('stock-list'); t.innerHTML="";
            stocks.forEach(s => {
                let sig = s.price < s.base*0.9 ? '<span class="sig-buy">BUY</span>' : (s.price > s.base*1.1 ? '<span class="sig-sell">SELL</span>' : 'HOLD');
                t.innerHTML += `<tr onclick="selStock(${s.id})" style="background:${selectedStockId===s.id?'#334155':''}"><td>${s.ticker}</td><td>${s.price.toFixed(2)}</td><td>${sig}</td><td>${s.owned}</td></tr>`;
            });
        }
        function selStock(id) { selectedStockId=id; updateChart(); }
        function updateChart() {
            let s = stocks[selectedStockId];
            document.getElementById('st-name').innerText = s.name;
            document.getElementById('st-price').innerText = s.price.toFixed(2)+" ‚Ç¨";
            chart.data.datasets[0].data = s.hist;
            chart.data.datasets[0].borderColor = s.hack.active ? '#eab308' : '#38bdf8';
            chart.update('none');
        }
        function trade(type) {
            let qty = parseInt(document.getElementById('st-qty').value)||1;
            let s = stocks[selectedStockId];
            if(type==='buy' && cash>=s.price*qty) { cash-=s.price*qty; s.owned+=qty; }
            if(type==='sell' && s.owned>=qty) { cash+=s.price*qty; s.owned-=qty; }
            ui();
        }
        function startHack() {
            let s = stocks[selectedStockId];
            let tar = parseFloat(document.getElementById('hack-target').value);
            let time = parseFloat(document.getElementById('hack-time').value);
            if(!tar || !time) return;
            s.hack = { active:true, start:s.price, target:tar, duration:time, tick:0 };
            notify("Hack gestartet!", "bad");
        }
        function toggleBot() { 
            botActive=!botActive; 
            document.getElementById('btn-bot').classList.toggle('bot-active'); 
        }
        function runBot() {
            // High Frequency Bot Logic
            stocks.forEach(s => {
                let avg = s.hist.reduce((a,b)=>a+b,0)/40;
                if(s.price < avg*0.95 && cash>s.price) { cash-=s.price; s.owned++; }
                else if(s.price > avg*1.05 && s.owned>0) { cash+=s.price; s.owned--; }
            });
            ui();
        }
        function createCompany() {
            let n = document.getElementById('ipo-name').value;
            let t = document.getElementById('ipo-ticker').value.toUpperCase();
            let shares = parseInt(document.getElementById('ipo-shares').value);
            if(!n || !t || !shares) return alert("Daten fehlen");
            if(cash<50000) return alert("Zu wenig Geld (50k n√∂tig)");
            cash-=50000;
            stocks.push({id:stocks.length, name:n, ticker:t, price:10, base:10, hist:Array(40).fill(10), owned:shares, hack:{active:false}});
            notify("Firma gegr√ºndet!", "good");
            nav('stocks');
        }

        // --- REAL ESTATE ---
        function renderEstate() {
            // Buy List
            let l = document.getElementById('estate-list'); l.innerHTML="";
            propsDB.forEach((p,i) => {
                l.innerHTML += `<div class="item-card"><div style="font-size:3em;float:right;opacity:0.2">${p.icon}</div><h3>${p.name}</h3><p>Marktmiete: ${p.market}‚Ç¨</p><button class="btn btn-green" onclick="buyProp(${i})">Kaufen ${fmt(p.cost)}</button></div>`;
            });
            // My List
            let m = document.getElementById('my-estate-list'); m.innerHTML="";
            myProperties.forEach((p,i) => {
                let st = p.tenant ? `<span class="status-badge st-rented">Vermietet: ${p.rent}‚Ç¨</span>` : `<span class="status-badge st-empty">Leer</span> <button class="btn" onclick="openNeg(${i})">Mieter suchen</button>`;
                m.innerHTML += `<div class="item-card"><h3>${p.name}</h3>${st}</div>`;
            });
        }
        function buyProp(dbId) {
            let p = propsDB[dbId];
            if(cash<p.cost) return alert("Geld fehlt");
            cash-=p.cost;
            myProperties.push({...p, tenant:false, rent:0});
            ui();
        }
        // Negotiation
        let negIdx = 0;
        function openNeg(idx) { negIdx=idx; document.getElementById('neg-market').innerText=myProperties[idx].market; document.getElementById('modal-neg').style.display='flex'; }
        function submitRent() {
            let offer = parseInt(document.getElementById('neg-input').value);
            let p = myProperties[negIdx];
            if(Math.random() < (p.market/offer)) { // Simple probability
                p.tenant=true; p.rent=offer; notify("Mieter akzeptiert!"); closeModals(); ui();
            } else { notify("Mieter lehnt ab!", "bad"); }
        }
        // Rent Cycle
        setInterval(() => {
            rentTimer--;
            if(rentTimer<=0) {
                rentTimer=15;
                let inc = 0;
                myProperties.forEach(p => { 
                    if(p.tenant) {
                        if(p.type==='com' && Math.random()<0.1) notify(`Raub im ${p.name}! Keine Miete.`, 'bad');
                        else inc += p.rent;
                    }
                });
                if(inc>0) { cash+=inc; notify(`Mieteinnahmen: ${fmt(inc)}`); ui(); }
            }
            if(document.getElementById('view-biz').classList.contains('active')) document.getElementById('rent-timer').innerText = rentTimer+"s";
        }, 1000);

        // --- JOBS ---
        let jobProgress = [0,0];
        function workJob(id) {
            let idx = id-1;
            jobProgress[idx] += 10;
            document.getElementById(`job-${id}-bar`).style.width = jobProgress[idx]+"%";
            if(jobProgress[idx] >= 100) {
                jobProgress[idx]=0;
                let wage = id===1 ? 250 : 500;
                cash += wage;
                notify(`Gehalt: +${wage}‚Ç¨`);
                ui();
                document.getElementById(`job-${id}-bar`).style.width = "0%";
            }
        }

        // --- LOOT ---
        function buyLoot(cost) {
            if(cash<cost) return alert("Geld fehlt");
            cash-=cost;
            let count = Math.floor(Math.random()*4); // 0 to 3 items
            let html = "";
            if(count===0) html="<h3 style='color:red'>LEER!</h3>";
            for(let i=0; i<count; i++) {
                let it = itemsDB[Math.floor(Math.random()*itemsDB.length)];
                inventory.push(it);
                html += `<div class="item-card" style="width:100px;"><h1>${it.i}</h1><small>${it.v}‚Ç¨</small></div>`;
            }
            document.getElementById('loot-content').innerHTML = html;
            document.getElementById('modal-loot').style.display='flex';
            ui();
        }
        function renderInv() {
            let c = document.getElementById('inv-list'); c.innerHTML="";
            inventory.forEach((it,i) => c.innerHTML+=`<div class="item-card" onclick="sellItem(${i})"><h1>${it.i}</h1><p>${it.n}</p><small style="color:var(--green)">${it.v}‚Ç¨</small></div>`);
            document.getElementById('inv-count').innerText = inventory.length;
        }
        function sellItem(i) { cash+=inventory[i].v; inventory.splice(i,1); ui(); }
        function sellAllLoot() { let t=0; inventory.forEach(i=>t+=i.v); cash+=t; inventory=[]; ui(); notify(`Alles f√ºr ${fmt(t)} verkauft`); }

        // --- CASINO ---
        function spinRoulette(col) {
            let bet = parseInt(document.getElementById('roul-bet').value);
            if(!bet || cash<bet) return;
            cash-=bet;
            let el = document.getElementById('roulette-wheel');
            el.style.transform = "rotate(720deg)";
            setTimeout(() => {
                el.style.transform = "rotate(0deg)";
                let win = Math.random()>0.5;
                if(win) { cash+=bet*2; notify("Gewonnen!"); } else { notify("Verloren", "bad"); }
                ui();
            }, 1000);
        }
        const syms = ["üçí","üçã","7Ô∏è‚É£"];
        function spinSlots() {
            if(cash<100) return; cash-=100;
            let r1=syms[Math.floor(Math.random()*3)], r2=syms[Math.floor(Math.random()*3)], r3=syms[Math.floor(Math.random()*3)];
            document.getElementById('slot1').innerText=r1; document.getElementById('slot2').innerText=r2; document.getElementById('slot3').innerText=r3;
            if(r1===r2 && r2===r3) { 
                let win = r1==="7Ô∏è‚É£"?5000:500; cash+=win; notify(`JACKPOT ${win}‚Ç¨!`); 
            }
            ui();
        }

        // INIT
        ui();
    </script>
</body>
</html>
