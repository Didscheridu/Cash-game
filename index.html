<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: CEO Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0b1120; --panel: #1e293b; --border: #334155;
            --accent: #38bdf8; --green: #22c55e; --red: #ef4444; --gold: #eab308; --purple: #d946ef;
            --text: #f8fafc;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; user-select: none; }
        
        /* ANIMATIONS */
        @keyframes pop { 0% { transform: scale(0.95); opacity:0; } 100% { transform: scale(1); opacity:1; } }
        @keyframes flashGreen { 0% { background: rgba(34, 197, 94, 0.3); } 100% { background: transparent; } }
        @keyframes flashRed { 0% { background: rgba(239, 68, 68, 0.3); } 100% { background: transparent; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

        /* SCROLLBAR HIDING */
        * { scrollbar-width: none; } /* Firefox */
        *::-webkit-scrollbar { display: none; } /* Chrome/Safari */

        /* LAYOUT */
        .view { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; max-width: 1600px; margin: 0 auto; }
        .view.active { display: block; animation: pop 0.3s ease-out; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--panel); padding: 15px; border-radius: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn { background: var(--border); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn:active { transform: scale(0.95); }
        .btn-green { background: var(--green); color: black; }
        .btn-red { background: var(--red); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-accent { background: var(--accent); color: black; }
        
        input, select { background: var(--bg); border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; text-align: center; width: 100%; box-sizing: border-box; }

        /* MENU */
        #menu { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle at top, #1e293b 0%, #0b1120 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 900px; width: 100%; padding: 20px; }
        .card { background: var(--panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .card h2 { margin: 10px 0 5px 0; }

        /* STOCK MARKET 2.0 */
        .stock-layout { display: grid; grid-template-columns: 300px 1fr; gap: 20px; height: 85vh; }
        .list-panel { background: var(--panel); border-radius: 12px; overflow-y: auto; border: 1px solid var(--border); }
        .detail-panel { background: var(--panel); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; border: 1px solid var(--border); }
        
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #0f172a; padding: 15px; text-align: left; border-bottom: 2px solid var(--border); z-index: 2; color: #94a3b8; }
        td { padding: 12px 15px; border-bottom: 1px solid var(--border); transition: background 0.3s; }
        tr:hover { background: #334155; cursor: pointer; }
        .row-up { animation: flashGreen 1s; }
        .row-down { animation: flashRed 1s; }

        .hacker-panel { margin-top: 15px; padding: 15px; background: #2a1010; border: 1px solid #5a2020; border-radius: 8px; }
        .bot-active { animation: pulse 1s infinite; border-color: var(--accent); color: var(--accent); background: rgba(56, 189, 248, 0.1); }

        /* BUSINESS & COMPANY */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; background: var(--panel); border: 1px solid var(--border); color: #888; cursor: pointer; text-align: center; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .tab:hover { background: #334155; }
        .tab.active { background: var(--accent); color: black; border-color: var(--accent); }
        
        .section { display: none; animation: pop 0.2s; }
        .section.active { display: block; }

        .grid-box { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .item-card { background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        
        /* COMPANY DASHBOARD */
        .company-dash { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .dash-card { background: #182030; padding: 20px; border-radius: 10px; border: 1px solid var(--border); }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .progress-container { background: #333; height: 10px; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .progress-bar { height: 100%; background: var(--green); width: 0%; transition: width 0.2s linear; }

        /* NOTIFICATIONS & MODALS */
        #notif-area { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .notif { background: rgba(15, 23, 42, 0.95); border-left: 4px solid var(--accent); padding: 15px; width: 300px; color: white; border-radius: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: center; }
        .modal-box { background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--accent); width: 90%; max-width: 450px; text-align: center; box-shadow: 0 0 50px rgba(56, 189, 248, 0.2); }

    </style>
</head>
<body>

    <div id="notif-area"></div>

    <div id="menu">
        <h1 style="color:var(--accent); font-size:4em; margin:0; letter-spacing: 5px; text-transform: uppercase;">Imperium</h1>
        <p style="color:#64748b; margin-top:-10px; margin-bottom: 30px;">CEO EDITION 17.0</p>
        <h2 style="color:var(--green); font-family:monospace; font-size:3em; margin-bottom:50px;" class="display-cash"></h2>
        
        <div class="menu-grid">
            <div class="card" onclick="nav('stocks')"><h1>üìà</h1><h2>Aktienmarkt</h2><p style="color:#888">12 Firmen, Realtime Charts</p></div>
            <div class="card" onclick="nav('biz')"><h1>üè¢</h1><h2>Firma & Business</h2><p style="color:#888">Gr√ºnde dein Unternehmen</p></div>
            <div class="card" onclick="nav('loot')"><h1>üéí</h1><h2>Auktionen</h2><p style="color:#888">Inventar & Handel</p></div>
            <div class="card" onclick="nav('casino')"><h1>üé∞</h1><h2>Casino</h2><p style="color:#888">Slots & Roulette</p></div>
        </div>
    </div>

    <div id="view-stocks" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.5em; font-family:monospace; color:var(--green)"></span>
        </div>
        <div class="stock-layout">
            <div class="list-panel">
                <table><thead><tr><th>Symbol</th><th>Kurs</th><th>Trend</th></tr></thead><tbody id="stock-list"></tbody></table>
            </div>
            <div class="detail-panel">
                <div style="display:flex; justify-content:space-between; align-items: flex-end;">
                    <div><h1 id="st-name" style="margin:0">Apple</h1><p id="st-ticker" style="color:#64748b; margin:0">AAPL</p></div>
                    <h1 id="st-price" style="margin:0; font-family:monospace">150.00 ‚Ç¨</h1>
                </div>
                <div style="flex:1; position:relative; min-height:300px; margin: 20px 0;"><canvas id="chart"></canvas></div>
                
                <div class="hacker-panel">
                    <div style="color:var(--red); font-weight:bold; font-family:monospace; margin-bottom:5px;">‚ö†Ô∏è MARKT-MANIPULATOR</div>
                    <div style="display:flex; gap:10px;">
                        <input id="hack-target" placeholder="Zielpreis ‚Ç¨" type="number">
                        <input id="hack-time" placeholder="Sekunden" type="number" style="width:80px" value="10">
                        <button class="btn btn-red" onclick="startHack()">üöÄ START</button>
                    </div>
                </div>

                <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <input id="st-qty" type="number" value="10" style="grid-column:span 2">
                    <button class="btn btn-green" onclick="trade('buy')">Kaufen</button>
                    <button class="btn btn-red" onclick="trade('sell')">Verkaufen</button>
                    <button id="btn-bot" class="btn" style="grid-column:span 2; border:1px solid var(--accent)" onclick="toggleBot()">ü§ñ Auto-Trader Bot</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-biz" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.5em; font-family:monospace; color:var(--green)"></span>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="tab('biz', 'company')">üè¢ Meine Firma</div>
            <div class="tab" onclick="tab('biz', 'estate')">üèòÔ∏è Immobilien</div>
            <div class="tab" onclick="tab('biz', 'jobs')">üíº Jobs</div>
        </div>

        <div id="tab-company" class="section active">
            <div id="company-create" style="max-width:500px; margin:50px auto; text-align:center;">
                <h1>Gr√ºnde dein Unternehmen</h1>
                <p style="color:#888; margin-bottom:30px;">Werde CEO. Produziere Waren oder handele mit G√ºtern.</p>
                <input id="comp-name" placeholder="Firmenname (z.B. Tesla 2.0)" style="font-size:1.2em; margin-bottom:10px;">
                <select id="comp-type" style="font-size:1.2em; margin-bottom:20px;">
                    <option value="prod">üè≠ Produktion (Hersteller)</option>
                    <option value="retail">üè™ Handel (Supermarkt)</option>
                </select>
                <p style="color:var(--gold)">Startkapital erforderlich: 25.000 ‚Ç¨</p>
                <button class="btn btn-accent" style="width:100%; padding:15px; font-size:1.2em;" onclick="foundCompany()">Firma gr√ºnden</button>
            </div>

            <div id="company-dash" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1 id="dash-title">MEINE FIRMA</h1>
                    <div style="text-align:right">
                        <span id="comp-level" style="background:var(--accent); color:black; padding:5px 10px; border-radius:5px; font-weight:bold;">Level 1</span>
                    </div>
                </div>

                <div class="company-dash">
                    <div class="dash-card">
                        <h2>‚öôÔ∏è Betrieb</h2>
                        <div class="stat-row"><span>Mitarbeiter:</span> <span id="comp-emp">0</span></div>
                        <div class="stat-row"><span>Gehaltskosten:</span> <span id="comp-wages" style="color:var(--red)">0 ‚Ç¨ / 30s</span></div>
                        <div class="stat-row"><span>Lagerbestand:</span> <span id="comp-stock">0</span></div>
                        
                        <div style="margin-top:20px; display:flex; gap:10px;">
                            <button class="btn btn-green" style="flex:1" onclick="hireEmp()">üë®‚Äçüíº Einstellen (+500‚Ç¨)</button>
                            <button class="btn btn-red" style="flex:1" onclick="fireEmp()">üî• Feuern</button>
                        </div>
                    </div>

                    <div class="dash-card">
                        <h2 id="action-title">Produktion</h2>
                        <p id="action-desc" style="color:#888">Rohstoffe kaufen & verarbeiten</p>
                        
                        <div id="prod-ui">
                            <button class="btn" style="width:100%; margin-bottom:10px;" onclick="compAction('buy')">üì¶ Material kaufen (-200‚Ç¨)</button>
                            <div class="progress-container"><div id="prod-bar" class="progress-bar"></div></div>
                            <p style="text-align:center; font-size:0.8em; color:#666">Mitarbeiter arbeiten automatisch...</p>
                            <button class="btn btn-gold" style="width:100%; margin-top:10px;" onclick="compAction('sell')">üí∞ Lager verkaufen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-estate" class="section">
            <div class="grid-box" id="estate-list"></div>
            <hr style="border-color:var(--border); margin:30px 0;">
            <h2>Mein Besitz</h2>
            <div class="grid-box" id="my-estate-list"></div>
        </div>

        <div id="tab-jobs" class="section">
            <div class="grid-box">
                <div class="item-card">
                    <h3>üçî Fast Food</h3><p>Burger braten</p>
                    <div class="progress-container"><div id="job-1-bar" class="progress-bar"></div></div>
                    <button class="btn" style="width:100%; margin-top:10px;" onmousedown="workJob(1)">Arbeiten (+100‚Ç¨)</button>
                </div>
                <div class="item-card">
                    <h3>üíª Freelancer</h3><p>Code schreiben</p>
                    <div class="progress-container"><div id="job-2-bar" class="progress-bar"></div></div>
                    <button class="btn btn-accent" style="width:100%; margin-top:10px;" onmousedown="workJob(2)">Arbeiten (+500‚Ç¨)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-loot" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div class="grid-box" style="margin-bottom:20px;">
            <div class="item-card" onclick="buyLoot(200)"><h1>üì¶</h1><h3>Box (200‚Ç¨)</h3></div>
            <div class="item-card" onclick="buyLoot(1500)"><h1>üöö</h1><h3>Truck (1.5k)</h3></div>
            <div class="item-card" onclick="buyLoot(8000)"><h1>üö¢</h1><h3>Container (8k)</h3></div>
        </div>
        <h2>Inventar <small id="inv-count"></small></h2>
        <button class="btn" onclick="sellAllLoot()">Alles verkaufen</button>
        <div id="inv-list" class="grid-box" style="margin-top:10px;"></div>
    </div>

    <div id="view-casino" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div class="tabs">
            <div class="tab active" onclick="tab('casino', 'slots')">Slots</div>
            <div class="tab" onclick="tab('casino', 'roulette')">Roulette</div>
        </div>
        <div id="tab-slots" class="section active" style="text-align:center;">
            <div style="font-size:4em; margin:20px; background:black; padding:20px; border-radius:10px; border:2px solid var(--gold); display:inline-block;">
                <span id="s1">üçí</span> <span id="s2">üçí</span> <span id="s3">üçí</span>
            </div>
            <p>Einsatz: 100‚Ç¨</p>
            <button class="btn btn-gold" style="font-size:1.5em; padding:10px 40px;" onclick="spinSlots()">SPIN</button>
        </div>
        <div id="tab-roulette" class="section" style="text-align:center;">
            <div id="r-wheel" style="font-size:6em; margin:20px; transition:1s;">üé≤</div>
            <input id="r-bet" type="number" placeholder="Einsatz" style="font-size:1.5em; width:200px;">
            <br><br>
            <button class="btn btn-red" onclick="spinRoulette('red')">Rot</button>
            <button class="btn" style="background:black" onclick="spinRoulette('black')">Schwarz</button>
        </div>
    </div>

    <div id="modal-neg" class="modal">
        <div class="modal-box">
            <h2>Mietpreis</h2>
            <p>Markt: <span id="neg-market" style="color:var(--accent)"></span> ‚Ç¨</p>
            <input id="neg-input" type="number" placeholder="Forderung">
            <br><br>
            <button class="btn btn-green" onclick="submitRent()">Angebot senden</button>
            <button class="btn" onclick="closeModals()">Abbrechen</button>
        </div>
    </div>

    <div id="modal-loot" class="modal">
        <div class="modal-box">
            <h2>Container Inhalt</h2>
            <div id="loot-content" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:20px 0;"></div>
            <button class="btn btn-green" onclick="closeModals()">OK</button>
        </div>
    </div>

    <script>
        // --- CORE DATA ---
        let cash = 50000;
        let inventory = [];
        let myProps = [];
        let myCompany = null;
        let stocks = [];
        const stockNames = ["Apple", "Tesla", "Amazon", "Google", "Microsoft", "Netflix", "Nvidia", "Meta", "Samsung", "Intel", "AMD", "Spotify"];
        let selStockId = 0;
        let chart;
        let botActive = false;

        // DBs
        const propDB = [
            {n:"Wohnung", c:5000, m:300, i:"üè†", t:"res"},
            {n:"Penthouse", c:50000, m:2500, i:"üè¢", t:"res"},
            {n:"Kiosk", c:15000, m:1000, i:"üè™", t:"com"},
            {n:"Supermarkt", c:100000, m:8000, i:"üõí", t:"com"}
        ];
        const itemDB = [{n:"Socke",v:5,i:"üß¶"},{n:"Stein",v:1,i:"ü™®"},{n:"Handy",v:500,i:"üì±"},{n:"Laptop",v:1200,i:"üíª"},{n:"Gold",v:5000,i:"ü•á"},{n:"Diamant",v:25000,i:"üíé"}];

        // --- INIT ---
        // Generiere 12 Aktien
        stockNames.forEach((n, i) => {
            stocks.push({
                id: i, name: n, ticker: n.substring(0,4).toUpperCase(),
                price: Math.random()*200+50, base: Math.random()*200+50,
                hist: Array(50).fill(0), owned: 0,
                hack: { active:false, start:0, target:0, dur:0, tick:0 }
            });
            stocks[i].hist.fill(stocks[i].price);
        });

        // Chart
        const ctx = document.getElementById('chart').getContext('2d');
        chart = new Chart(ctx, { type:'line', data:{labels:Array(50).fill(''), datasets:[{data:[], borderColor:'#38bdf8', borderWidth:2, pointRadius:0, tension:0.2, fill:true, backgroundColor:'rgba(56,189,248,0.1)'}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}}} });

        // --- NAVIGATION ---
        function fmt(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function notify(msg, type='good') {
            let n = document.createElement('div'); n.className='notif'; n.innerText=msg; 
            n.style.borderColor = type==='bad' ? 'var(--red)' : 'var(--accent)';
            document.getElementById('notif-area').appendChild(n);
            setTimeout(()=>n.remove(), 3000);
        }
        function ui() {
            document.querySelectorAll('.display-cash').forEach(e=>e.innerText=fmt(cash));
            renderInv();
            if(myCompany) updateCompanyUI();
        }
        function nav(id) {
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.getElementById('menu').style.display = id==='menu'?'flex':'none';
            if(id!=='menu') {
                document.getElementById('view-'+id).classList.add('active');
                if(id==='stocks') setTimeout(()=>chart.resize(), 100);
                if(id==='biz') renderEstate();
            }
        }
        function tab(ctx, id) {
            document.querySelectorAll(`#view-${ctx} .section`).forEach(e=>e.classList.remove('active'));
            document.querySelectorAll(`#view-${ctx} .tab`).forEach(e=>e.classList.remove('active'));
            document.getElementById(`tab-${id}`).classList.add('active');
            event.target.classList.add('active');
        }
        function closeModals() { document.querySelectorAll('.modal').forEach(e=>e.style.display='none'); }

        // --- STOCKS LOGIC ---
        setInterval(() => {
            stocks.forEach(s => {
                let old = s.price;
                if(s.hack.active) {
                    s.hack.tick++; let p = s.hack.tick/s.hack.dur;
                    if(p>=1) { s.price=s.hack.target; s.hack.active=false; notify(`${s.name} Ziel erreicht!`); }
                    else s.price = s.hack.start + (s.hack.target-s.hack.start)*p + (Math.random()-0.5)*5;
                } else {
                    s.price += (Math.random()-0.5)*(s.price*0.03);
                    s.price += (s.base - s.price)*0.01; // Mean Reversion
                }
                if(s.price<1) s.price=1;
                s.hist.shift(); s.hist.push(s.price);
                s.dir = s.price >= old ? 'up' : 'down';
            });
            if(document.getElementById('view-stocks').classList.contains('active')) { renderStockList(); updateChart(); }
            if(botActive) runBot();
        }, 1000);

        function renderStockList() {
            let h = "";
            stocks.forEach(s => {
                let cls = s.dir === 'up' ? 'row-up' : 'row-down';
                let col = s.dir === 'up' ? 'var(--green)' : 'var(--red)';
                h += `<tr onclick="selStock(${s.id})" style="background:${selectedStockId===s.id?'#334155':''}" class="${cls}"><td><b>${s.ticker}</b><br><small>${s.name}</small></td><td style="color:${col}">${s.price.toFixed(2)}</td><td>${s.owned}</td></tr>`;
            });
            document.getElementById('stock-list').innerHTML = h;
        }
        function selStock(id) { selectedStockId=id; updateChart(); }
        function updateChart() {
            let s = stocks[selectedStockId];
            document.getElementById('st-name').innerText = s.name;
            document.getElementById('st-price').innerText = s.price.toFixed(2)+" ‚Ç¨";
            chart.data.datasets[0].data = s.hist;
            chart.data.datasets[0].borderColor = s.hack.active ? '#eab308' : '#38bdf8';
            chart.update('none');
        }
        function trade(t) {
            let qty = parseInt(document.getElementById('st-qty').value)||1;
            let s = stocks[selectedStockId];
            if(t==='buy' && cash>=s.price*qty) { cash-=s.price*qty; s.owned+=qty; }
            if(t==='sell' && s.owned>=qty) { cash+=s.price*qty; s.owned-=qty; }
            ui();
        }
        function toggleBot() { botActive=!botActive; document.getElementById('btn-bot').classList.toggle('bot-active'); }
        function runBot() {
            stocks.forEach(s => {
                let avg = s.hist.reduce((a,b)=>a+b,0)/50;
                if(s.price < avg*0.98 && cash>s.price) { cash-=s.price; s.owned++; }
                else if(s.price > avg*1.02 && s.owned>0) { cash+=s.price; s.owned--; }
            });
            ui();
        }
        function startHack() {
            let t = parseFloat(document.getElementById('hack-target').value);
            let d = parseFloat(document.getElementById('hack-time').value);
            if(t && d) { stocks[selectedStockId].hack = {active:true, start:stocks[selectedStockId].price, target:t, dur:d, tick:0}; notify("Hack gestartet!", "bad"); }
        }

        // --- COMPANY SYSTEM ---
        function foundCompany() {
            let n = document.getElementById('comp-name').value;
            let t = document.getElementById('comp-type').value;
            if(!n) return alert("Name fehlt");
            if(cash<25000) return alert("Geld fehlt");
            cash-=25000;
            myCompany = { name:n, type:t, employees:0, stock:0, progress:0 };
            document.getElementById('company-create').style.display='none';
            document.getElementById('company-dash').style.display='block';
            document.getElementById('dash-title').innerText = n.toUpperCase();
            
            if(t==='prod') { document.getElementById('action-title').innerText="Fabrik"; document.getElementById('action-desc').innerText="Material -> Produkte"; }
            else { document.getElementById('action-title').innerText="Verkauf"; document.getElementById('action-desc').innerText="Ware -> Kunden"; }
            
            ui();
            
            // Company Loop
            setInterval(() => {
                if(myCompany.employees > 0) {
                    // Auto Work
                    myCompany.progress += myCompany.employees * 2;
                    if(myCompany.progress >= 100) {
                        myCompany.progress = 0;
                        myCompany.stock += 1; // Produziert 1 Einheit
                    }
                    if(document.getElementById('tab-company').classList.contains('active')) {
                        document.getElementById('prod-bar').style.width = myCompany.progress+"%";
                        updateCompanyUI();
                    }
                }
            }, 500); // Fast tick

            // Wages Loop (30s)
            setInterval(() => {
                if(myCompany.employees > 0) {
                    let cost = myCompany.employees * 50; // 50‚Ç¨ pro MA
                    if(cash >= cost) {
                        cash -= cost;
                        notify(`Geh√§lter bezahlt: -${cost}‚Ç¨`);
                    } else {
                        notify("Streik! Kein Geld f√ºr Geh√§lter!", "bad");
                        myCompany.employees = 0; // Alle gehen
                    }
                    ui();
                }
            }, 30000);
        }

        function hireEmp() { if(cash>=500) { cash-=500; myCompany.employees++; ui(); } else notify("Zu wenig Geld"); }
        function fireEmp() { if(myCompany.employees>0) { myCompany.employees--; ui(); } }
        function compAction(type) {
            if(type==='buy') {
                if(cash>=200) { cash-=200; myCompany.stock+=5; notify("Material gekauft"); ui(); }
            } else {
                if(myCompany.stock>0) { 
                    let val = myCompany.stock * (myCompany.type==='prod' ? 80 : 60); // Verkaufspreis
                    cash+=val; myCompany.stock=0; notify(`Verkauft f√ºr ${fmt(val)}`); ui(); 
                }
            }
        }
        function updateCompanyUI() {
            document.getElementById('comp-emp').innerText = myCompany.employees;
            document.getElementById('comp-stock').innerText = myCompany.stock;
            document.getElementById('comp-wages').innerText = `-${myCompany.employees*50} ‚Ç¨ / 30s`;
        }

        // --- ESTATE ---
        let negIdx=0;
        function renderEstate() {
            let b = document.getElementById('estate-list'); b.innerHTML="";
            propDB.forEach((p,i) => b.innerHTML+=`<div class="item-card"><div style="font-size:3em;float:right;opacity:0.2">${p.i}</div><h3>${p.n}</h3><p>Markt: ${p.m}‚Ç¨</p><button class="btn btn-green" onclick="buyProp(${i})">Kaufen ${fmt(p.c)}</button></div>`);
            let m = document.getElementById('my-estate-list'); m.innerHTML="";
            myProps.forEach((p,i) => {
                let st = p.tenant ? `<span class="status-badge st-rented">Miete: ${p.rent}‚Ç¨</span>` : `<button class="btn" onclick="openNeg(${i})">Mieter suchen</button>`;
                m.innerHTML+=`<div class="item-card"><h3>${p.n}</h3>${st}</div>`;
            });
        }
        function buyProp(i) { if(cash>=propDB[i].c) { cash-=propDB[i].c; myProps.push({...propDB[i], tenant:false, rent:0}); ui(); renderEstate(); } }
        function openNeg(i) { negIdx=i; document.getElementById('neg-market').innerText=myProps[i].m; document.getElementById('modal-neg').style.display='flex'; }
        function submitRent() {
            let offer = parseInt(document.getElementById('neg-input').value);
            let p = myProps[negIdx];
            if(Math.random() < (p.m/offer)) { p.tenant=true; p.rent=offer; notify("Vermietet!"); closeModals(); renderEstate(); }
            else notify("Mieter lehnt ab", "bad");
        }
        // Rent Loop
        setInterval(() => {
            let inc=0; myProps.forEach(p=>{ if(p.tenant) { if(p.t==='com' && Math.random()<0.05) notify(`Raub in ${p.n}!`, "bad"); else inc+=p.rent; } });
            if(inc>0) { cash+=inc; notify(`Miete: +${fmt(inc)}`); ui(); }
        }, 15000);

        // --- JOBS ---
        let jobP = [0,0];
        function workJob(id) {
            let i=id-1; jobP[i]+=10;
            document.getElementById(`job-${id}-bar`).style.width=jobP[i]+"%";
            if(jobP[i]>=100) { jobP[i]=0; let w=id===1?100:500; cash+=w; notify(`Verdienst: +${w}‚Ç¨`); ui(); document.getElementById(`job-${id}-bar`).style.width="0%"; }
        }

        // --- LOOT ---
        function buyLoot(c) {
            if(cash<c) return; cash-=c;
            let n = Math.floor(Math.random()*4);
            let h = "";
            for(let i=0;i<n;i++) { let it=itemDB[Math.floor(Math.random()*itemDB.length)]; inventory.push(it); h+=`<div class="item-card" style="width:80px"><h1>${it.i}</h1><small>${it.v}‚Ç¨</small></div>`; }
            document.getElementById('loot-content').innerHTML = h||"<h3>LEER!</h3>";
            document.getElementById('modal-loot').style.display='flex';
            ui();
        }
        function renderInv() {
            let d = document.getElementById('inv-list'); d.innerHTML="";
            inventory.forEach((it,i)=>d.innerHTML+=`<div class="item-card" onclick="sellItem(${i})"><h1>${it.i}</h1><p>${it.n}</p><small style="color:var(--green)">${it.v}‚Ç¨</small></div>`);
            document.getElementById('inv-count').innerText=inventory.length;
        }
        function sellItem(i) { cash+=inventory[i].v; inventory.splice(i,1); ui(); }
        function sellAllLoot() { let t=0; inventory.forEach(i=>t+=i.v); cash+=t; inventory=[]; ui(); notify(`Alles verkauft: +${fmt(t)}`); }

        // --- CASINO ---
        function spinRoulette(c) {
            let b=parseInt(document.getElementById('r-bet').value); if(!b||cash<b)return; cash-=b;
            let el=document.getElementById('r-wheel'); el.style.transform="rotate(720deg)";
            setTimeout(()=>{ el.style.transform="rotate(0deg)"; let w=Math.random()>0.5; if(w){cash+=b*2;notify("Gewonnen!");}else notify("Verloren","bad"); ui(); },1000);
        }
        const sl=["üçí","üçã","7Ô∏è‚É£"];
        function spinSlots() {
            if(cash<100)return; cash-=100;
            let r1=sl[Math.floor(Math.random()*3)], r2=sl[Math.floor(Math.random()*3)], r3=sl[Math.floor(Math.random()*3)];
            document.getElementById('s1').innerText=r1; document.getElementById('s2').innerText=r2; document.getElementById('s3').innerText=r3;
            if(r1===r2&&r2===r3) { let w=r1==="7Ô∏è‚É£"?5000:500; cash+=w; notify(`WIN ${w}‚Ç¨`); } ui();
        }

        // Init
        ui();
    </script>
</body>
</html>
