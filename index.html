<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall Street: Market Manipulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-main: #121212;
            --bg-secondary: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #888;
            --accent-green: #00e676;
            --accent-red: #ff5252;
            --accent-blue: #2979ff;
            --accent-gold: #ffd700;
        }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
        }

        .app-wrapper {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100%;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard-header {
            background-color: var(--bg-secondary);
            padding: 15px 30px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #333;
        }
        .cash-display { font-size: 2em; color: var(--accent-green); font-weight: bold; }
        .portfolio-val { color: var(--text-muted); }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            overflow: hidden;
        }

        .market-list-panel {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid #333;
            overflow-y: auto;
            padding: 10px;
        }
        
        .stock-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
        .stock-table th { text-align: left; position: sticky; top: 0; background: var(--bg-secondary); padding: 10px; color: var(--text-muted); z-index: 10;}
        .stock-table td { padding: 8px; border-bottom: 1px solid #333; cursor: pointer;}
        .stock-table tr:hover { background-color: #2a2a2a; }
        .stock-name { font-weight: bold; color: var(--accent-blue); }
        .price-up { color: var(--accent-green); }
        .price-down { color: var(--accent-red); }
        .price-boost { color: var(--accent-gold); font-weight: bold; text-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }

        .chart-panel {
            background-color: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        .chart-header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;}
        .chart-container { flex-grow: 1; position: relative; }
        
        .trade-controls { margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; display: flex; gap: 10px; align-items: center;}
        
        button {
            padding: 12px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.9em; transition: 0.2s; color: white;
        }
        button:active { transform: scale(0.98); }
        .btn-buy { background-color: var(--accent-green); flex-grow: 1; }
        .btn-sell { background-color: var(--accent-red); flex-grow: 1; }
        
        /* Der neue Boost Button */
        .btn-boost { 
            background: linear-gradient(45deg, #FFD700, #FFA500); 
            color: #000; 
            flex-grow: 2;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        .btn-boost:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed;}

        input[type=number] { padding: 10px; border-radius: 6px; border: 1px solid #444; background: #333; color: white; width: 80px; text-align: center; font-size: 1em;}

        #noSelectionPlaceholder {
            display: flex; justify-content: center; align-items: center; height: 100%; color: var(--text-muted); font-size: 1.2em;
        }
        #selectedStockView { display: none; height: 100%; flex-direction: column; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <div class="dashboard-header">
        <div><h1>Wall Street Manipulator</h1></div>
        <div style="text-align: right;">
            <div>Bargeld: <span class="cash-display" id="cashDisplay">10.000 â‚¬</span></div>
            <div class="portfolio-val">Portfolio Wert: <span id="portfolioValue">0 â‚¬</span></div>
        </div>
    </div>

    <div class="main-content">
        <div class="market-list-panel">
            <table class="stock-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Name</th>
                        <th>Preis</th>
                        <th>Besitz</th>
                    </tr>
                </thead>
                <tbody id="stockListBody"></tbody>
            </table>
        </div>

        <div class="chart-panel">
            <div id="noSelectionPlaceholder">
                <p>ðŸ‘ˆ WÃ¤hle eine Aktie aus der Liste.</p>
            </div>

            <div id="selectedStockView">
                <div class="chart-header">
                    <div>
                        <h2 style="margin:0;" id="chartStockName">Aktien Name</h2>
                        <h3 style="margin:5px 0;" id="chartStockPrice">0.00 â‚¬</h3>
                    </div>
                    <div id="boostStatus" style="display:none; color: var(--accent-gold); font-weight:bold; border: 1px solid var(--accent-gold); padding: 5px 10px; border-radius: 4px;">
                        ðŸš€ BOOST AKTIV
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="stockChartCanvas"></canvas>
                </div>

                <div class="trade-controls">
                    <input type="number" id="tradeAmount" value="10" min="1">
                    <button class="btn-buy" onclick="tradeSelected('buy')">KAUFEN</button>
                    <button class="btn-sell" onclick="tradeSelected('sell')">VERKAUFEN</button>
                    <button class="btn-boost" id="btnBoost" onclick="activateBoost()">ðŸš€ BOOST (15s)</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- KONFIGURATION ---
    const START_CASH = 10000;
    const STOCK_COUNT = 100;
    const TICK_RATE_MS = 1000; 
    const HISTORY_LENGTH = 60; 

    // --- GLOBALE VARIABLEN ---
    let cash = START_CASH;
    let stocks = [];
    let selectedStockId = null;
    let stockChart = null; 

    // --- SETUP ---
    const prefixes = ["Apex", "Global", "Future", "Tech", "Quant", "Silver", "Blue", "Red", "Alpha", "Omega", "Prime"];
    const suffixes = ["Systems", "Corp", "Inc", "Solutions", "Technologies", "Group", "Financial", "Energy", "Labs"];
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    function generateStockName(id) {
        let ticker = letters[Math.floor(Math.random() * 26)] + letters[Math.floor(Math.random() * 26)] + letters[Math.floor(Math.random() * 26)];
        let name = prefixes[id % prefixes.length] + " " + suffixes[Math.floor(Math.random() * suffixes.length)];
        return { ticker, name };
    }

    function initGame() {
        for (let i = 0; i < STOCK_COUNT; i++) {
            let naming = generateStockName(i);
            let startPrice = (Math.random() * 200) + 10;
            let volatility = (Math.random() * 0.025) + 0.005; 
            if(Math.random() > 0.9) volatility *= 5;

            stocks.push({
                id: i,
                ticker: naming.ticker,
                name: naming.name,
                price: startPrice,
                owned: 0,
                volatility: volatility,
                history: Array(HISTORY_LENGTH).fill(startPrice),
                lastTrend: 0,
                // NEU: Boost Timer (0 = inaktiv)
                boostTimer: 0 
            });
        }

        const ctx = document.getElementById('stockChartCanvas').getContext('2d');
        stockChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(HISTORY_LENGTH).fill(''),
                datasets: [{
                    label: 'Kurs',
                    data: [],
                    borderColor: '#2979ff',
                    backgroundColor: 'rgba(41, 121, 255, 0.1)',
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: true,
                    tension: 0.2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false, 
                scales: {
                    x: { display: false },
                    y: { grid: { color: '#333' }, ticks: { color: '#888' } }
                },
                plugins: { legend: { display: false } }
            }
        });

        renderStockTable();
        updatePortfolioValue();
    }

    // --- MARKT LOOP ---
    setInterval(() => {
        stocks.forEach(stock => {
            
            // LOGIK: Normale Bewegung ODER Boost
            if (stock.boostTimer > 0) {
                // BOOST LOGIK:
                // Um Faktor 10 in 15 Schritten zu erreichen: 10^(1/15) â‰ˆ 1.1659
                stock.price = stock.price * 1.1659;
                stock.boostTimer--; // Timer runterzÃ¤hlen
                stock.lastTrend = 2; // 2 steht fÃ¼r "Super Boost Trend"
            } else {
                // NORMALE LOGIK:
                let percentChange = (Math.random() - 0.5) * 2 * stock.volatility;
                let oldPrice = stock.price;
                stock.price = stock.price * (1 + percentChange);
                if(stock.price < 1) stock.price = 1.00 + Math.random();
                stock.lastTrend = stock.price >= oldPrice ? 1 : -1;
            }

            stock.history.shift(); 
            stock.history.push(stock.price);
        });

        renderStockTable();
        updatePortfolioValue();
        if(selectedStockId !== null) {
            updateChartView(selectedStockId);
        }

    }, TICK_RATE_MS);


    // --- FUNKTIONEN ---

    // NEU: Die Boost Funktion
    function activateBoost() {
        if (selectedStockId === null) return;
        
        let stock = stocks[selectedStockId];
        
        if (stock.boostTimer > 0) {
            alert("Boost lÃ¤uft bereits!");
            return;
        }

        // Wir setzen den Timer auf 15 Sekunden (Ticks)
        stock.boostTimer = 15;
        
        // Optional: Kleiner Soundeffekt oder Alert
        // alert(stock.name + " geht zum Mond! ðŸš€");
        
        // UI sofort updaten
        updateChartView(selectedStockId);
    }

    function renderStockTable() {
        const tbody = document.getElementById('stockListBody');
        let html = '';
        stocks.forEach(stock => {
            let priceClass = 'price-down';
            if (stock.lastTrend === 1) priceClass = 'price-up';
            if (stock.lastTrend === 2) priceClass = 'price-boost'; // Goldene Farbe bei Boost

            let selectedClass = stock.id === selectedStockId ? 'style="background-color: #333;"' : '';

            html += `
                <tr onclick="selectStock(${stock.id})" ${selectedClass}>
                    <td class="stock-name">${stock.ticker}</td>
                    <td>${stock.name}</td>
                    <td class="${priceClass}">${formatMoney(stock.price)}</td>
                    <td>${stock.owned}</td>
                </tr>
            `;
        });
        tbody.innerHTML = html;
        document.getElementById('cashDisplay').innerText = formatMoney(cash);
    }

    function updatePortfolioValue() {
        let value = 0;
        stocks.forEach(s => { value += s.price * s.owned; });
        document.getElementById('portfolioValue').innerText = formatMoney(value + cash);
    }

    function selectStock(id) {
        selectedStockId = id;
        document.getElementById('noSelectionPlaceholder').style.display = 'none';
        document.getElementById('selectedStockView').style.display = 'flex';
        updateChartView(id);
        renderStockTable();
    }

    function updateChartView(id) {
        const stock = stocks[id];
        const priceEl = document.getElementById('chartStockPrice');
        const boostBadge = document.getElementById('boostStatus');
        const boostBtn = document.getElementById('btnBoost');

        document.getElementById('chartStockName').innerText = `${stock.name} (${stock.ticker})`;
        priceEl.innerText = formatMoney(stock.price);
        
        // Farben und Status basierend auf Boost
        if (stock.boostTimer > 0) {
            priceEl.className = 'price-boost';
            boostBadge.style.display = 'block';
            boostBadge.innerText = `ðŸš€ BOOST: ${stock.boostTimer}s`;
            boostBtn.disabled = true; // Button sperren wÃ¤hrend Boost lÃ¤uft
            
            // Chart Farbe Gold
            stockChart.data.datasets[0].borderColor = '#FFD700';
            stockChart.data.datasets[0].backgroundColor = 'rgba(255, 215, 0, 0.2)';
        } else {
            priceEl.className = stock.lastTrend > 0 ? 'price-up' : 'price-down';
            boostBadge.style.display = 'none';
            boostBtn.disabled = false;

            // Chart Farbe GrÃ¼n/Rot
            if(stock.lastTrend > 0) {
                 stockChart.data.datasets[0].borderColor = '#00e676';
                 stockChart.data.datasets[0].backgroundColor = 'rgba(0, 230, 118, 0.1)';
            } else {
                 stockChart.data.datasets[0].borderColor = '#ff5252';
                 stockChart.data.datasets[0].backgroundColor = 'rgba(255, 82, 82, 0.1)';
            }
        }

        stockChart.data.datasets[0].data = stock.history;
        stockChart.update();
    }

    function tradeSelected(type) {
        if(selectedStockId === null) return;
        const stock = stocks[selectedStockId];
        const amountInput = document.getElementById('tradeAmount');
        let amount = parseInt(amountInput.value);

        if(isNaN(amount) || amount <= 0) { alert("Menge ungÃ¼ltig"); return; }

        if(type === 'buy') {
            let cost = stock.price * amount;
            if(cash >= cost) {
                cash -= cost;
                stock.owned += amount;
            } else { alert("Zu wenig Geld!"); }
        } else {
            if(stock.owned >= amount) {
                cash += stock.price * amount;
                stock.owned -= amount;
            } else { alert("Nicht genug Aktien!"); }
        }
        updatePortfolioValue();
        renderStockTable();
    }

    function formatMoney(number) {
        return number.toLocaleString('de-DE', { style: 'currency', currency: 'EUR' });
    }

    initGame();
</script>
</body>
</html>
