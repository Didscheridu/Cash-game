<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Imperium: Tycoon</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0b1120; --panel: #1e293b; --border: #334155;
            --accent: #38bdf8; --green: #22c55e; --red: #ef4444; --gold: #eab308;
            --text: #f8fafc;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow: hidden; user-select: none; }
        
        /* LAYOUT & UI */
        .view { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; max-width: 1600px; margin: 0 auto; }
        .view.active { display: block; animation: fade 0.3s; }
        @keyframes fade { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; background: var(--panel); padding: 15px; border-radius: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .btn { background: var(--border); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-green { background: var(--green); color: black; }
        .btn-red { background: var(--red); color: white; }
        .btn-accent { background: var(--accent); color: black; }
        
        input { background: var(--bg); border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; text-align: center; width: 100%; box-sizing: border-box; }

        /* MENU */
        #menu { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle at top, #1e293b 0%, #0b1120 100%); }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 900px; width: 100%; padding: 20px; }
        .card { background: var(--panel); padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid var(--border); transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

        /* --- COMPANY TYCOON STYLES --- */
        .creation-form { max-width: 600px; margin: 0 auto; background: var(--panel); padding: 30px; border-radius: 15px; border: 1px solid var(--accent); }
        .material-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; text-align: left; }
        .mat-check { display: flex; align-items: center; gap: 5px; background: #0f172a; padding: 10px; border-radius: 5px; cursor: pointer; border: 1px solid var(--border); }
        .mat-check input { width: auto; }
        .mat-check:hover { border-color: var(--accent); }

        .dept-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px; }
        .dept-card { background: #162032; padding: 15px; border-radius: 10px; border-top: 4px solid #666; display: flex; flex-direction: column; justify-content: space-between; min-height: 250px; }
        .dept-buy { border-color: var(--accent); }
        .dept-make { border-color: var(--gold); }
        .dept-sell { border-color: var(--green); }
        
        .worker-count { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .progress-track { background: #000; height: 15px; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; width: 0%; transition: width 0.2s linear; }
        
        .console-log { background: #000; color: #0f0; font-family: monospace; height: 150px; overflow-y: auto; padding: 10px; border-radius: 5px; font-size: 0.8em; border: 1px solid #333; margin-top: 20px; }
        .log-entry { margin-bottom: 2px; border-bottom: 1px solid #111; }

        /* STOCK MARKET */
        .stock-layout { display: grid; grid-template-columns: 300px 1fr; gap: 20px; height: 85vh; }
        .list-panel { background: var(--panel); overflow-y: auto; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 12px; border-bottom: 1px solid var(--border); text-align: left; }
        tr:hover { background: #334155; cursor: pointer; }
        
        /* NOTIFICATIONS */
        #notif-area { position: fixed; bottom: 20px; right: 20px; z-index: 999; display: flex; flex-direction: column; gap: 10px; }
        .notif { background: rgba(15, 23, 42, 0.95); border-left: 4px solid var(--accent); padding: 15px; width: 300px; color: white; border-radius: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <div id="notif-area"></div>

    <div id="menu">
        <h1 style="color:var(--accent); font-size:4em; margin:0; letter-spacing: 5px;">IMPERIUM</h1>
        <p style="color:#64748b; margin-bottom: 30px;">INDUSTRIAL UPDATE 18.0</p>
        <h2 style="color:var(--green); font-family:monospace; font-size:3em; margin-bottom:50px;" class="display-cash"></h2>
        <div class="menu-grid">
            <div class="card" onclick="nav('stocks')"><h1>üìà</h1><h2>Aktienmarkt</h2><p>Full-Screen Charts</p></div>
            <div class="card" onclick="nav('company')"><h1>üè≠</h1><h2>Meine Firma</h2><p>Produktion & Management</p></div>
            <div class="card" onclick="nav('estate')"><h1>üèôÔ∏è</h1><h2>Immobilien</h2><p>Vermieter werden</p></div>
            <div class="card" onclick="nav('casino')"><h1>üé∞</h1><h2>Casino</h2><p>High Stakes</p></div>
        </div>
    </div>

    <div id="view-stocks" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.5em; font-family:monospace; color:var(--green)"></span>
        </div>
        <div class="stock-layout">
            <div class="list-panel">
                <table><thead><tr><th>Symbol</th><th>Kurs</th></tr></thead><tbody id="stock-list"></tbody></table>
            </div>
            <div style="background:var(--panel); padding:20px; border-radius:10px; display:flex; flex-direction:column;">
                <div style="display:flex; justify-content:space-between;">
                    <h1 id="st-name" style="margin:0">Apple</h1>
                    <h1 id="st-price" style="font-family:monospace; margin:0">150 ‚Ç¨</h1>
                </div>
                <div style="flex:1; position:relative; min-height:300px; margin:20px 0;"><canvas id="chart"></canvas></div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-green" style="flex:1" onclick="tradeStock('buy')">Kaufen</button>
                    <button class="btn btn-red" style="flex:1" onclick="tradeStock('sell')">Verkaufen</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-company" class="view">
        <div class="top-bar">
            <button class="btn" onclick="nav('menu')">üè† Men√º</button>
            <span class="display-cash" style="font-size:1.5em; font-family:monospace; color:var(--green)"></span>
        </div>

        <div id="comp-create" class="creation-form">
            <h1 style="text-align:center">üè≠ Fabrik er√∂ffnen</h1>
            <p style="color:#888; text-align:center">Entwerfe dein Produkt und die Lieferkette.</p>
            
            <label>Firmenname</label>
            <input id="c-name" placeholder="z.B. CyberCorp">
            
            <label style="margin-top:15px; display:block">Produktname</label>
            <input id="c-prod" placeholder="z.B. Quanten-Toaster">

            <p style="margin-top:20px; font-weight:bold">Ben√∂tigte Rohstoffe (W√§hle mind. 1):</p>
            <div class="material-grid" id="mat-selection">
                </div>
            
            <div style="background:#000; padding:15px; border-radius:5px; margin-top:20px;">
                <div style="display:flex; justify-content:space-between;"><span>Materialkosten:</span> <span id="calc-cost">0 ‚Ç¨</span></div>
                <div style="display:flex; justify-content:space-between; color:var(--green); font-weight:bold; font-size:1.2em;"><span>Marktpreis:</span> <span id="calc-price">0 ‚Ç¨</span></div>
            </div>

            <button class="btn btn-accent" style="width:100%; margin-top:20px; font-size:1.2em" onclick="foundCompany()">Firma gr√ºnden (50.000 ‚Ç¨)</button>
        </div>

        <div id="comp-dash" style="display:none">
            <h1 id="dash-header" style="text-align:center; text-transform:uppercase; letter-spacing:5px; color:var(--accent)">FIRMA</h1>
            
            <div style="display:flex; justify-content:space-around; background:var(--panel); padding:15px; border-radius:10px; margin-bottom:20px;">
                <div>üì¶ Rohstoffe: <span id="stock-raw" style="color:var(--accent); font-weight:bold">0</span></div>
                <div>üè≠ Produkte: <span id="stock-fin" style="color:var(--gold); font-weight:bold">0</span></div>
                <div>üí∏ Lohnkosten: <span id="wage-cost" style="color:var(--red)">0</span> ‚Ç¨ / min</div>
            </div>

            <div class="dept-grid">
                <div class="dept-card dept-buy">
                    <h3>üîµ EINKAUF</h3>
                    <p style="font-size:0.8em; color:#888">Kauft Rohstoffe automatisch.</p>
                    <div class="worker-count" id="count-buy">0</div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-green" style="flex:1" onclick="hire('buy')">+ Hire</button>
                        <button class="btn btn-red" onclick="fire('buy')">-</button>
                    </div>
                </div>

                <div class="dept-card dept-make">
                    <h3>üü° PRODUKTION</h3>
                    <p style="font-size:0.8em; color:#888">Verarbeitet Rohstoffe.</p>
                    <div class="worker-count" id="count-make">0</div>
                    
                    <div class="progress-track"><div id="prog-bar" class="progress-fill" style="background:var(--gold)"></div></div>
                    
                    <div style="display:flex; gap:5px; margin-top:auto;">
                        <button class="btn btn-green" style="flex:1" onclick="hire('make')">+ Hire</button>
                        <button class="btn btn-red" onclick="fire('make')">-</button>
                    </div>
                </div>

                <div class="dept-card dept-sell">
                    <h3>üü¢ VERTRIEB</h3>
                    <p style="font-size:0.8em; color:#888">Verkauft an Kunden.</p>
                    <div class="worker-count" id="count-sell">0</div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-green" style="flex:1" onclick="hire('sell')">+ Hire</button>
                        <button class="btn btn-red" onclick="fire('sell')">-</button>
                    </div>
                </div>
            </div>

            <div class="console-log" id="comp-log">
                <div class="log-entry">System bereit...</div>
            </div>
        </div>
    </div>

    <div id="view-estate" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div id="estate-list" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:15px;"></div>
    </div>

    <div id="view-casino" class="view">
        <div class="top-bar"><button class="btn" onclick="nav('menu')">üè† Men√º</button><span class="display-cash"></span></div>
        <div style="text-align:center; margin-top:50px">
            <h1 style="font-size:5em">üé∞</h1>
            <input type="number" id="bet" placeholder="Einsatz" style="width:200px; font-size:1.5em">
            <br><br>
            <button class="btn btn-red" onclick="spin()">Rot/Schwarz (50%)</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        let cash = 60000;
        let company = null;
        let stocks = [];
        const stockNames = ["Tesla", "Apple", "Amazon", "Google", "Meta", "Nvidia", "AMD", "Intel", "Netflix", "Spotify"];
        
        // Material DB
        const rawMaterials = [
            {id:'wood', n:'Holz', c:10}, {id:'plastic', n:'Plastik', c:20}, 
            {id:'metal', n:'Metall', c:50}, {id:'silicon', n:'Silizium', c:100}, 
            {id:'gold', n:'Gold', c:500}, {id:'lithium', n:'Lithium', c:200}
        ];

        // --- CORE ---
        function fmt(n) { return n.toLocaleString('de-DE', {style:'currency', currency:'EUR'}); }
        function notify(msg) {
            let n = document.createElement('div'); n.className='notif'; n.innerText=msg;
            document.getElementById('notif-area').appendChild(n); setTimeout(()=>n.remove(),3000);
        }
        function log(msg) {
            let l = document.getElementById('comp-log');
            let e = document.createElement('div'); e.className='log-entry'; e.innerText=`> ${msg}`;
            l.prepend(e); if(l.children.length>20) l.lastChild.remove();
        }
        function ui() {
            document.querySelectorAll('.display-cash').forEach(e=>e.innerText=fmt(cash));
            if(company) updateCompUI();
        }
        function nav(id) {
            document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
            document.getElementById('menu').style.display=id==='menu'?'flex':'none';
            if(id!=='menu') {
                document.getElementById('view-'+id).classList.add('active');
                if(id==='stocks') resizeChart();
            }
        }

        // --- COMPANY LOGIC ---
        // 1. Setup Material Selection
        let selectedMats = [];
        let matGrid = document.getElementById('mat-selection');
        rawMaterials.forEach(m => {
            let div = document.createElement('div'); div.className='mat-check';
            div.innerHTML = `<input type="checkbox" onchange="toggleMat('${m.id}')"> ${m.n} (${m.c}‚Ç¨)`;
            matGrid.appendChild(div);
        });

        function toggleMat(id) {
            if(selectedMats.includes(id)) selectedMats = selectedMats.filter(x=>x!==id);
            else selectedMats.push(id);
            calcEstimate();
        }

        function calcEstimate() {
            let cost = 0;
            selectedMats.forEach(id => cost += rawMaterials.find(x=>x.id===id).c);
            document.getElementById('calc-cost').innerText = fmt(cost);
            document.getElementById('calc-price').innerText = fmt(cost * 2.5); // 2.5x Marge
            return cost;
        }

        function foundCompany() {
            let name = document.getElementById('c-name').value;
            let prod = document.getElementById('c-prod').value;
            let costPerUnit = calcEstimate();
            
            if(!name || !prod || selectedMats.length===0) return alert("Bitte alle Felder ausf√ºllen!");
            if(cash < 50000) return alert("Zu wenig Geld!");
            
            cash -= 50000;
            
            company = {
                name: name, product: prod,
                cost: costPerUnit, price: costPerUnit * 2.5,
                raw: 0, fin: 0,
                staff: { buy:0, make:0, sell:0 },
                progress: 0
            };

            document.getElementById('comp-create').style.display='none';
            document.getElementById('comp-dash').style.display='block';
            document.getElementById('dash-header').innerText = name;
            ui();
        }

        // 2. Operations
        function hire(role) { if(cash>=500){cash-=500; company.staff[role]++; ui();} }
        function fire(role) { if(company.staff[role]>0){company.staff[role]--; ui();} }

        function updateCompUI() {
            document.getElementById('stock-raw').innerText = company.raw;
            document.getElementById('stock-fin').innerText = company.fin;
            document.getElementById('count-buy').innerText = company.staff.buy;
            document.getElementById('count-make').innerText = company.staff.make;
            document.getElementById('count-sell').innerText = company.staff.sell;
            
            let wages = (company.staff.buy + company.staff.make + company.staff.sell) * 50;
            document.getElementById('wage-cost').innerText = `-${wages}`;
        }

        // GAME LOOP (100ms)
        setInterval(() => {
            if(!company) return;

            // 1. EINKAUFER (Buy Raw)
            if(company.staff.buy > 0) {
                // Kaufen wenn weniger als 50 Rohstoffe pro Mitarbeiter da sind
                if(company.raw < company.staff.buy * 50) {
                    let buyCost = company.cost; 
                    // Rabatt: Je mehr Eink√§ufer, desto billiger (max 20%)
                    let discount = Math.min(0.2, company.staff.buy * 0.01); 
                    buyCost = buyCost * (1 - discount);

                    if(cash >= buyCost) {
                        cash -= buyCost;
                        company.raw++;
                        if(Math.random()<0.1) log(`Einkauf: +1 Material (${fmt(buyCost)})`);
                    }
                }
            }

            // 2. PRODUZENTEN (Make Product)
            if(company.staff.make > 0 && company.raw > 0) {
                let speed = company.staff.make * 2; // Speed multiplier
                company.progress += speed;
                
                if(company.progress >= 100) {
                    company.progress = 0;
                    company.raw--;
                    company.fin++;
                    log(`Fertigung: 1 ${company.product} fertig!`);
                }
            }
            document.getElementById('prog-bar').style.width = Math.min(100, company.progress) + "%";

            // 3. VERK√ÑUFER (Sell Product)
            if(company.staff.sell > 0 && company.fin > 0) {
                // Verkaufschance erh√∂ht durch Anzahl Verk√§ufer
                if(Math.random() < (company.staff.sell * 0.05)) {
                    let sellPrice = company.price;
                    // Bonus: Gute Verk√§ufer holen mehr raus
                    sellPrice += (company.staff.sell * 2);
                    
                    company.fin--;
                    cash += sellPrice;
                    log(`Verkauf: +${fmt(sellPrice)}`);
                }
            }

            ui();
        }, 100);

        // Wages Interval (30s)
        setInterval(() => {
            if(company) {
                let totalStaff = company.staff.buy + company.staff.make + company.staff.sell;
                if(totalStaff > 0) {
                    let cost = totalStaff * 50;
                    if(cash >= cost) {
                        cash -= cost;
                        log(`Lohnzahlung: -${fmt(cost)}`);
                    } else {
                        log("STREIK! Keine Geh√§lter bezahlt!");
                        company.staff.buy = 0; company.staff.make = 0; company.staff.sell = 0;
                    }
                }
            }
        }, 30000);


        // --- STOCKS ---
        stockNames.forEach((n,i)=>stocks.push({id:i, name:n, price:Math.random()*200+50, hist:Array(40).fill(0), owned:0}));
        
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {type:'line', data:{labels:Array(40).fill(''), datasets:[{data:[], borderColor:'#38bdf8', borderWidth:2, pointRadius:0, tension:0.1, fill:true, backgroundColor:'rgba(56,189,248,0.1)'}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}}}});

        setInterval(() => {
            stocks.forEach(s => {
                s.price += (Math.random()-0.5)*5; if(s.price<1)s.price=1;
                s.hist.shift(); s.hist.push(s.price);
            });
            if(document.getElementById('view-stocks').classList.contains('active')) {
                let h="";
                stocks.forEach(s=>h+=`<tr onclick="selStock(${s.id})"><td><b>${s.name.substring(0,4).toUpperCase()}</b></td><td>${s.price.toFixed(2)}</td></tr>`);
                document.getElementById('stock-list').innerHTML=h;
                updateChart();
            }
        }, 1000);
        let selStockId=0;
        function selStock(id){selStockId=id;updateChart();}
        function updateChart(){
            let s=stocks[selStockId];
            document.getElementById('st-name').innerText=s.name;
            document.getElementById('st-price').innerText=s.price.toFixed(2)+"‚Ç¨";
            chart.data.datasets[0].data=s.hist; chart.update('none');
        }
        function resizeChart(){setTimeout(()=>chart.resize(),100);}
        function tradeStock(t){
            let s=stocks[selStockId];
            if(t==='buy'&&cash>=s.price){cash-=s.price; s.owned++;}
            if(t==='sell'&&s.owned>0){cash+=s.price; s.owned--;}
            ui();
        }

        // --- ESTATE (Simplified) ---
        const props = [{n:"Kiosk",c:15000,i:500},{n:"Supermarkt",c:100000,i:5000}];
        function initEstate(){
            let d=document.getElementById('estate-list');
            props.forEach(p=>d.innerHTML+=`<div style="background:var(--panel);padding:15px;border-radius:10px;border:1px solid var(--border)"><h3>${p.n}</h3><p>Miete: ${p.i}‚Ç¨</p><button class="btn btn-green" onclick="buyProp(${p.c},${p.i})">Kaufen ${fmt(p.c)}</button></div>`);
        }
        function buyProp(c,i){if(cash>=c){cash-=c; setInterval(()=>{cash+=i;notify(`Miete +${i}‚Ç¨`);ui()},15000); notify("Gekauft!"); ui();}}

        // --- CASINO ---
        function spin(){let b=parseInt(document.getElementById('bet').value);if(b&&cash>=b){cash-=b;if(Math.random()>0.5){cash+=b*2;notify("Gewonnen!");}else notify("Verloren");ui();}}

        // Init
        initEstate();
        ui();
    </script>
</body>
</html>
