<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imperium OS: Ultimate</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --border: #334155;
            --accent: #38bdf8; /* Blau */
            --success: #22c55e; /* Gr√ºn */
            --danger: #ef4444; /* Rot */
            --warning: #f59e0b; /* Orange */
            --text: #f8fafc;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text); margin: 0; height: 100vh; display: flex; overflow: hidden; }

        /* --- LAYOUT --- */
        .sidebar { width: 260px; background: var(--bg-panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; z-index: 10; }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; background: radial-gradient(circle at top right, #1e293b 0%, #0f172a 70%); position: relative; }

        /* SIDEBAR ITEMS */
        .brand { font-size: 1.5rem; font-weight: bold; color: var(--accent); margin-bottom: 40px; letter-spacing: 2px; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .nav-btn { background: transparent; border: none; color: #94a3b8; padding: 15px; text-align: left; cursor: pointer; border-radius: 8px; font-size: 1rem; margin-bottom: 5px; transition: 0.2s; display: flex; align-items: center; gap: 15px; }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-btn.active { background: var(--accent); color: #0f172a; font-weight: bold; box-shadow: 0 0 15px rgba(56, 189, 248, 0.4); }
        
        .cash-display { margin-top: auto; background: #0f172a; padding: 15px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }
        .cash-val { font-size: 1.4rem; color: var(--success); font-weight: bold; font-family: monospace; }

        /* --- VIEWS --- */
        .view { display: none; animation: fadeIn 0.4s ease-out; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS & GRIDS --- */
        .grid { display: grid; gap: 20px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        .card { background: rgba(30, 41, 59, 0.7); border: 1px solid var(--border); border-radius: 12px; padding: 20px; backdrop-filter: blur(10px); position: relative; overflow: hidden; }
        .card h2 { margin-top: 0; font-size: 1.2rem; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; }

        /* BUTTONS */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: var(--accent); color: #0f172a; }
        .btn-success { background: var(--success); color: #0f172a; }
        .btn-danger { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; width: auto; }

        /* --- COMPANY VISUALS --- */
        .process-chain { display: flex; gap: 10px; margin-bottom: 20px; }
        .process-step { flex: 1; background: #0f172a; padding: 15px; border-radius: 8px; border: 1px solid var(--border); text-align: center; position: relative; }
        .process-step::after { content: '‚Üí'; position: absolute; right: -15px; top: 50%; transform: translateY(-50%); color: var(--border); font-size: 1.5rem; }
        .process-step:last-child::after { content: ''; }
        
        .step-icon { font-size: 2rem; margin-bottom: 10px; color: #64748b; }
        .step-active .step-icon { color: var(--accent); animation: pulse 2s infinite; }
        
        .progress-container { background: #1e293b; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.2s linear; }
        
        /* --- STOCK MARKET --- */
        .stock-list { height: 400px; overflow-y: auto; }
        .stock-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .stock-item:hover { background: rgba(255,255,255,0.05); }
        .stock-up { color: var(--success); } .stock-down { color: var(--danger); }

        /* --- NOTIFICATIONS --- */
        #toast-area { position: fixed; bottom: 20px; right: 20px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--bg-panel); border-left: 4px solid var(--accent); padding: 15px; border-radius: 6px; width: 300px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); animation: slideIn 0.3s; color: white; display: flex; align-items: center; gap: 10px; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* --- MODALS --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-box { background: var(--bg-panel); width: 500px; padding: 30px; border-radius: 12px; border: 1px solid var(--accent); }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 15px; }

    </style>
</head>
<body>

    <div id="toast-area"></div>

    <div class="sidebar">
        <div class="brand"><i class="fas fa-crown"></i> Imperium</div>
        
        <button class="nav-btn active" onclick="Nav.to('dash')"><i class="fas fa-home"></i> √úbersicht</button>
        <button class="nav-btn" onclick="Nav.to('company')"><i class="fas fa-building"></i> Meine Firma</button>
        <button class="nav-btn" onclick="Nav.to('stocks')"><i class="fas fa-chart-line"></i> Aktienmarkt</button>
        <button class="nav-btn" onclick="Nav.to('estate')"><i class="fas fa-city"></i> Immobilien</button>
        <button class="nav-btn" onclick="Nav.to('casino')"><i class="fas fa-dice"></i> Casino</button>

        <div class="cash-display">
            <div style="font-size:0.8rem; color:#64748b; margin-bottom:5px;">Verm√∂gen</div>
            <div class="cash-val" id="ui-cash">0 ‚Ç¨</div>
        </div>
    </div>

    <div class="main-content">

        <div id="view-dash" class="view active">
            <h1 style="margin-bottom: 20px;">Willkommen zur√ºck, CEO.</h1>
            <div class="grid grid-2">
                <div class="card">
                    <h2><i class="fas fa-wallet"></i> Finanzstatus</h2>
                    <p>Bargeld: <span id="dash-cash" style="color:var(--success)">0 ‚Ç¨</span></p>
                    <p>Firmenwert: <span id="dash-val" style="color:var(--accent)">0 ‚Ç¨</span></p>
                    <p>Immobilien: <span id="dash-props">0</span></p>
                </div>
                <div class="card" onclick="Nav.to('company')" style="cursor:pointer">
                    <h2><i class="fas fa-industry"></i> Firmen-Schnellzugriff</h2>
                    <div id="dash-company-status">
                        <p style="color:#64748b">Noch keine Firma gegr√ºndet.</p>
                        <button class="btn btn-primary">Jetzt Gr√ºnden</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-company" class="view">
            <div id="comp-create" style="max-width:500px; margin: 0 auto; text-align:center;">
                <h1 style="color:var(--accent)">Startup Gr√ºnden</h1>
                <p style="color:#94a3b8; margin-bottom:30px;">Baue dein Produktions-Imperium auf.</p>
                <input id="c-name" placeholder="Firmenname (z.B. CyberDyne)">
                <select id="c-type">
                    <option value="tech">Technologie (High Tech)</option>
                    <option value="auto">Automobil (Industrie)</option>
                    <option value="food">Lebensmittel (Massenmarkt)</option>
                </select>
                <div class="card" style="margin-bottom:20px;">
                    <p>Startkapital ben√∂tigt: <span style="color:var(--warning)">25.000 ‚Ç¨</span></p>
                </div>
                <button class="btn btn-success" onclick="Company.create()">Gr√ºndung unterschreiben</button>
            </div>

            <div id="comp-manage" style="display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1 id="comp-header-name">FIRMA</h1>
                    <button class="btn btn-primary" style="width:auto;" onclick="Company.openDesigner()"><i class="fas fa-pencil-ruler"></i> Produkt Designen</button>
                </div>

                <div class="process-chain">
                    <div class="process-step" id="step-buy">
                        <div class="step-icon"><i class="fas fa-boxes"></i></div>
                        <h3>Einkauf</h3>
                        <p>Rohstoffe: <span id="val-raw" style="color:var(--accent)">0</span></p>
                        <div class="progress-container"><div id="bar-buy" class="progress-bar" style="background:var(--accent)"></div></div>
                        <div style="font-size:0.8rem; margin-bottom:5px;">Personal: <span id="staff-buy">0</span></div>
                        <div style="display:flex; gap:5px;">
                            <button class="btn btn-success btn-sm" onclick="Company.hire('buy')">+</button>
                            <button class="btn btn-danger btn-sm" onclick="Company.fire('buy')">-</button>
                        </div>
                    </div>

                    <div class="process-step" id="step-make">
                        <div class="step-icon"><i class="fas fa-cogs"></i></div>
                        <h3>Produktion</h3>
                        <p>Lager: <span id="val-stock" style="color:var(--warning)">0</span></p>
                        <div class="progress-container"><div id="bar-make" class="progress-bar" style="background:var(--warning)"></div></div>
                        <div style="font-size:0.8rem; margin-bottom:5px;">Personal: <span id="staff-make">0</span></div>
                        <div style="display:flex; gap:5px;">
                            <button class="btn btn-success btn-sm" onclick="Company.hire('make')">+</button>
                            <button class="btn btn-danger btn-sm" onclick="Company.fire('make')">-</button>
                        </div>
                    </div>

                    <div class="process-step" id="step-sell">
                        <div class="step-icon"><i class="fas fa-hand-holding-usd"></i></div>
                        <h3>Verkauf</h3>
                        <p>Offene Orders: <span id="val-orders" style="color:var(--success)">0</span></p>
                        <div class="progress-container"><div id="bar-sell" class="progress-bar" style="background:var(--success)"></div></div>
                        <div style="font-size:0.8rem; margin-bottom:5px;">Personal: <span id="staff-sell">0</span></div>
                        <div style="display:flex; gap:5px;">
                            <button class="btn btn-success btn-sm" onclick="Company.hire('sell')">+</button>
                            <button class="btn btn-danger btn-sm" onclick="Company.fire('sell')">-</button>
                        </div>
                    </div>

                    <div class="process-step" id="step-ship">
                        <div class="step-icon"><i class="fas fa-truck"></i></div>
                        <h3>Logistik</h3>
                        <p>Unterwegs: <span id="val-ship" style="color:#fff">0</span></p>
                        <div class="progress-container"><div id="bar-ship" class="progress-bar" style="background:#fff"></div></div>
                        <div style="font-size:0.8rem; margin-bottom:5px;">Personal: <span id="staff-ship">0</span></div>
                        <div style="display:flex; gap:5px;">
                            <button class="btn btn-success btn-sm" onclick="Company.hire('ship')">+</button>
                            <button class="btn btn-danger btn-sm" onclick="Company.fire('ship')">-</button>
                        </div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <h2>Auftr√§ge & Status</h2>
                        <div id="contract-list" style="height:200px; overflow-y:auto; font-size:0.9rem;">
                            </div>
                    </div>
                    <div class="card">
                        <h2>Finanzen (Live)</h2>
                        <p>Aktuelles Produkt: <span id="ui-prod-name" style="color:var(--accent)">Keines</span></p>
                        <p>Verkaufspreis: <span id="ui-prod-price">0</span> ‚Ç¨</p>
                        <p>Kosten (Personal): <span id="ui-wages" style="color:var(--danger)">0</span> ‚Ç¨/Min</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-stocks" class="view">
            <div class="grid" style="grid-template-columns: 300px 1fr;">
                <div class="card">
                    <h2>Markt√ºbersicht</h2>
                    <div class="stock-list" id="stock-list-container">
                        </div>
                </div>
                <div class="card">
                    <h2 id="chart-header">Aktie w√§hlen...</h2>
                    <div style="height:300px;"><canvas id="stockChart"></canvas></div>
                    <div style="margin-top:20px; display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <input type="number" id="stock-amount" value="10">
                        <div style="line-height:45px;">Besitz: <span id="stock-owned">0</span></div>
                        <button class="btn btn-success" onclick="Stocks.trade('buy')">Kaufen</button>
                        <button class="btn btn-danger" onclick="Stocks.trade('sell')">Verkaufen</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-estate" class="view">
            <h1>Immobilienmarkt</h1>
            <div class="grid grid-4" id="estate-list">
                </div>
            <h2 style="margin-top:40px;">Mein Portfolio</h2>
            <div class="grid grid-4" id="my-estate-list"></div>
        </div>

        <div id="view-casino" class="view">
            <div style="max-width:400px; margin:50px auto; text-align:center;" class="card">
                <h2><i class="fas fa-dice"></i> Roulette</h2>
                <div id="roulette-result" style="font-size:4rem; margin:20px 0;">üé≤</div>
                <input type="number" id="casino-bet" placeholder="Einsatz">
                <div class="grid grid-2">
                    <button class="btn btn-danger" onclick="Casino.spin('red')">Rot</button>
                    <button class="btn" style="background:black; color:white;" onclick="Casino.spin('black')">Schwarz</button>
                </div>
            </div>
        </div>

    </div>

    <div id="modal-product" class="modal">
        <div class="modal-box">
            <h2>Neues Produkt entwerfen</h2>
            <label>Name</label>
            <input id="prod-design-name" placeholder="z.B. iPhone 20">
            <label>Verkaufspreis festlegen</label>
            <input type="range" id="prod-design-price" min="10" max="500" value="100" oninput="Company.updatePreview()">
            <p>Preis: <span id="preview-price" style="font-weight:bold; color:var(--accent)">100</span> ‚Ç¨</p>
            <p>Kundenmeinung: <span id="preview-sentiment">Neutral</span></p>
            <button class="btn btn-success" onclick="Company.launchProduct()">Produktion starten</button>
            <button class="btn btn-danger" style="margin-top:10px;" onclick="document.getElementById('modal-product').style.display='none'">Abbrechen</button>
        </div>
    </div>

    <div id="modal-neg" class="modal">
        <div class="modal-box">
            <h2>Mietvertrag</h2>
            <p>Marktwert: <span id="neg-val"></span> ‚Ç¨</p>
            <input id="neg-offer" type="number" placeholder="Deine Forderung">
            <button class="btn btn-primary" onclick="Estate.submitOffer()">Angebot senden</button>
            <button class="btn btn-danger" style="margin-top:10px;" onclick="document.getElementById('modal-neg').style.display='none'">Abbrechen</button>
        </div>
    </div>

    <script>
        /* --- GAME ENGINE --- */
        const Game = {
            cash: 50000,
            
            init: function() {
                Stocks.init();
                Estate.init();
                UI.update();
                
                // Main Loop (100ms)
                setInterval(() => {
                    Company.tick();
                    Stocks.tick();
                    UI.update();
                }, 100);

                // Slow Loop (1s)
                setInterval(() => {
                    Estate.tick();
                }, 1000);
            }
        };

        /* --- UI MANAGER --- */
        const UI = {
            toast: function(msg, type='info') {
                const el = document.createElement('div');
                el.className = 'toast';
                el.innerHTML = type==='success' ? `<i class="fas fa-check"></i> ${msg}` : `<i class="fas fa-info-circle"></i> ${msg}`;
                if(type==='error') el.style.borderLeftColor = 'var(--danger)';
                document.getElementById('toast-area').appendChild(el);
                setTimeout(()=>el.remove(), 3000);
            },
            update: function() {
                document.querySelectorAll('#ui-cash, .cash-val').forEach(el => el.innerText = Game.cash.toLocaleString() + " ‚Ç¨");
                document.getElementById('dash-cash').innerText = Game.cash.toLocaleString() + " ‚Ç¨";
                
                if(Company.active) {
                    document.getElementById('dash-company-status').innerHTML = `<h3 style="color:var(--accent)">${Company.data.name}</h3><button class="btn btn-primary btn-sm" onclick="Nav.to('company')">Verwalten</button>`;
                }
            }
        };

        const Nav = {
            to: function(id) {
                document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
                document.getElementById('view-'+id).classList.add('active');
                
                // Highlight button logic would go here
            }
        };

        /* --- COMPANY SYSTEM (THE COMPLEX PART) --- */
        const Company = {
            active: false,
            data: null,
            
            create: function() {
                let name = document.getElementById('c-name').value;
                if(!name) return UI.toast("Name fehlt!", "error");
                if(Game.cash < 25000) return UI.toast("Zu wenig Geld!", "error");
                
                Game.cash -= 25000;
                this.data = {
                    name: name,
                    raw: 0, stock: 0, orders: 0,
                    staff: { buy:0, make:0, sell:0, ship:0 },
                    progress: { buy:0, make:0, sell:0, ship:0 },
                    product: { name: "Prototyp", price: 50, cost: 10 }
                };
                this.active = true;
                
                document.getElementById('comp-create').style.display = 'none';
                document.getElementById('comp-manage').style.display = 'block';
                document.getElementById('comp-header-name').innerText = name;
                UI.toast("Firma gegr√ºndet!", "success");
            },

            hire: function(role) {
                if(Game.cash >= 500) {
                    Game.cash -= 500;
                    this.data.staff[role]++;
                    this.updateUI();
                } else UI.toast("Nicht genug Geld (500‚Ç¨)", "error");
            },
            fire: function(role) {
                if(this.data.staff[role] > 0) {
                    this.data.staff[role]--;
                    this.updateUI();
                }
            },

            tick: function() {
                if(!this.active) return;
                const d = this.data;

                // 1. EINKAUF (Raw Materials)
                if(d.staff.buy > 0 && d.raw < d.staff.buy * 50) {
                    d.progress.buy += d.staff.buy * 2;
                    if(d.progress.buy >= 100) {
                        if(Game.cash >= 10) { Game.cash -= 10; d.raw++; d.progress.buy = 0; }
                    }
                } else d.progress.buy = 0;

                // 2. PRODUKTION (Make)
                if(d.staff.make > 0 && d.raw > 0) {
                    d.progress.make += d.staff.make * 2;
                    if(d.progress.make >= 100) {
                        d.raw--; d.stock++; d.progress.make = 0;
                    }
                } else d.progress.make = 0;

                // 3. VERKAUF (Find Customers)
                if(d.staff.sell > 0) {
                    // Chance depends on price
                    let chance = (100 / d.product.price) * d.staff.sell;
                    d.progress.sell += chance;
                    if(d.progress.sell >= 100) {
                        d.orders++; d.progress.sell = 0;
                        this.log(`Auftrag erhalten (+${d.product.price}‚Ç¨)`);
                    }
                }

                // 4. LOGISTIK (Ship & Cash)
                if(d.staff.ship > 0 && d.orders > 0 && d.stock > 0) {
                    d.progress.ship += d.staff.ship * 3;
                    if(d.progress.ship >= 100) {
                        d.stock--; d.orders--;
                        Game.cash += d.product.price;
                        d.progress.ship = 0;
                    }
                } else d.progress.ship = 0;

                // WAGES (Small tick drain logic simulation)
                if(Math.random() < 0.01) {
                    let wages = (d.staff.buy + d.staff.make + d.staff.sell + d.staff.ship) * 10;
                    if(Game.cash >= wages) Game.cash -= wages;
                    else { // Strike logic
                        UI.toast("Streik! Kein Geld f√ºr L√∂hne.", "error");
                        d.staff.buy=0; d.staff.make=0; d.staff.sell=0; d.staff.ship=0;
                    }
                }

                this.updateUI();
            },

            updateUI: function() {
                const d = this.data;
                document.getElementById('val-raw').innerText = d.raw;
                document.getElementById('val-stock').innerText = d.stock;
                document.getElementById('val-orders').innerText = d.orders;
                document.getElementById('val-ship').innerText = d.orders > 0 && d.stock > 0 ? "Liefert..." : "Warten";

                ['buy','make','sell','ship'].forEach(r => {
                    document.getElementById('staff-'+r).innerText = d.staff[r];
                    document.getElementById('bar-'+r).style.width = Math.min(100, d.progress[r]) + "%";
                    // Visual active state
                    const step = document.getElementById('step-'+r);
                    if(d.progress[r] > 5) step.classList.add('step-active'); else step.classList.remove('step-active');
                });

                document.getElementById('ui-prod-name').innerText = d.product.name;
                document.getElementById('ui-prod-price').innerText = d.product.price;
                document.getElementById('ui-wages').innerText = (d.staff.buy + d.staff.make + d.staff.sell + d.staff.ship) * 100;
            },

            log: function(msg) {
                let div = document.getElementById('contract-list');
                div.innerHTML = `<div style="padding:5px; border-bottom:1px solid #333">${msg}</div>` + div.innerHTML;
            },

            // Designer
            openDesigner: function() { document.getElementById('modal-product').style.display='flex'; },
            updatePreview: function() {
                let p = parseInt(document.getElementById('prod-design-price').value);
                document.getElementById('preview-price').innerText = p;
                let s = "Neutral";
                if(p < 40) s = "Begeistert! (Sehr viele Verk√§ufe)";
                else if(p > 150) s = "W√ºtend (Kaum Verk√§ufe)";
                document.getElementById('preview-sentiment').innerText = s;
            },
            launchProduct: function() {
                let n = document.getElementById('prod-design-name').value;
                let p = parseInt(document.getElementById('prod-design-price').value);
                if(n) {
                    this.data.product.name = n;
                    this.data.product.price = p;
                    UI.toast("Produktion umgestellt!", "success");
                    document.getElementById('modal-product').style.display='none';
                }
            }
        };

        /* --- STOCKS --- */
        const Stocks = {
            list: [],
            chart: null,
            selected: 0,

            init: function() {
                const names = ["TechCorp", "Banana Inc", "SoftMicro", "GigaNet", "SpaceX"];
                names.forEach((n,i) => {
                    this.list.push({id:i, name:n, price:Math.random()*100+50, hist:Array(40).fill(100), owned:0});
                });
                
                const ctx = document.getElementById('stockChart').getContext('2d');
                this.chart = new Chart(ctx, {type:'line', data:{labels:Array(40).fill(''), datasets:[{data:[], borderColor:'#38bdf8', borderWidth:2, pointRadius:0, tension:0.1, fill:true, backgroundColor:'rgba(56,189,248,0.1)'}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:false}, scales:{x:{display:false}, y:{grid:{color:'#334155'}}}}});
                
                this.renderList();
            },

            tick: function() {
                this.list.forEach(s => {
                    s.price += (Math.random()-0.5)*5;
                    if(s.price<1) s.price=1;
                    s.hist.shift(); s.hist.push(s.price);
                });
                if(document.getElementById('view-stocks').style.display === 'block') {
                    this.renderList();
                    this.updateChart();
                }
            },

            renderList: function() {
                let h = "";
                this.list.forEach(s => {
                    let change = s.price > s.hist[38] ? 'stock-up' : 'stock-down';
                    h += `<div class="stock-item" onclick="Stocks.select(${s.id})" style="background:${this.selected===s.id?'rgba(56,189,248,0.1)':''}">
                        <div><b>${s.name}</b></div>
                        <div class="${change}">${s.price.toFixed(2)}‚Ç¨</div>
                    </div>`;
                });
                document.getElementById('stock-list-container').innerHTML = h;
            },

            select: function(id) { this.selected=id; this.updateChart(); },
            updateChart: function() {
                let s = this.list[this.selected];
                document.getElementById('chart-header').innerText = `${s.name} (${s.price.toFixed(2)}‚Ç¨)`;
                document.getElementById('stock-owned').innerText = s.owned;
                this.chart.data.datasets[0].data = s.hist;
                this.chart.update('none');
            },
            
            trade: function(type) {
                let s = this.list[this.selected];
                let qty = parseInt(document.getElementById('stock-amount').value);
                if(type==='buy' && Game.cash >= s.price*qty) { Game.cash-=s.price*qty; s.owned+=qty; }
                if(type==='sell' && s.owned >= qty) { Game.cash+=s.price*qty; s.owned-=qty; }
            }
        };

        /* --- REAL ESTATE --- */
        const Estate = {
            props: [{n:"Kiosk", c:10000, m:500, i:"üè™"}, {n:"B√ºro", c:50000, m:2000, i:"üè¢"}, {n:"Fabrik", c:200000, m:8000, i:"üè≠"}],
            owned: [],
            negIdx: 0,

            init: function() {
                let h="";
                this.props.forEach((p,i) => {
                    h += `<div class="card"><h1>${p.i}</h1><h3>${p.n}</h3><p>Miete: ~${p.m}‚Ç¨</p><button class="btn btn-success" onclick="Estate.buy(${i})">Kaufen ${p.c.toLocaleString()}‚Ç¨</button></div>`;
                });
                document.getElementById('estate-list').innerHTML = h;
            },

            buy: function(i) {
                if(Game.cash >= this.props[i].c) {
                    Game.cash -= this.props[i].c;
                    this.owned.push({...this.props[i], tenant:false, rent:0});
                    this.renderOwned();
                    UI.toast("Gekauft!", "success");
                }
            },

            renderOwned: function() {
                let h="";
                this.owned.forEach((p,i) => {
                    let st = p.tenant ? `<span style="color:var(--success)">Vermietet (${p.rent}‚Ç¨)</span>` : `<button class="btn btn-primary btn-sm" onclick="Estate.openNeg(${i})">Mieter suchen</button>`;
                    h += `<div class="card"><h3>${p.n}</h3>${st}</div>`;
                });
                document.getElementById('my-estate-list').innerHTML = h;
            },

            openNeg: function(i) { this.negIdx=i; document.getElementById('neg-val').innerText=this.owned[i].m; document.getElementById('modal-neg').style.display='flex'; },
            
            submitOffer: function() {
                let off = parseInt(document.getElementById('neg-offer').value);
                let p = this.owned[this.negIdx];
                if(Math.random() < (p.m / off)) {
                    p.tenant = true; p.rent = off;
                    document.getElementById('modal-neg').style.display='none';
                    this.renderOwned();
                    UI.toast("Mieter gefunden!", "success");
                } else UI.toast("Angebot abgelehnt.", "error");
            },

            tick: function() {
                let inc = 0;
                this.owned.forEach(p => { if(p.tenant) inc += p.rent; });
                if(inc > 0) { Game.cash += inc; UI.toast(`Mieteinnahmen: +${inc}‚Ç¨`); }
            }
        };

        /* --- CASINO --- */
        const Casino = {
            spin: function(col) {
                let b = parseInt(document.getElementById('casino-bet').value);
                if(!b || Game.cash<b) return UI.toast("Einsatz ung√ºltig", "error");
                Game.cash -= b;
                
                let el = document.getElementById('roulette-result');
                el.style.transform = "rotate(360deg)";
                el.style.transition = "0.5s";
                
                setTimeout(() => {
                    el.style.transform = "rotate(0deg)";
                    let win = Math.random() > 0.5 ? 'red' : 'black';
                    el.innerText = win==='red' ? 'üî¥' : '‚ö´';
                    
                    if(win === col) { Game.cash += b*2; UI.toast("Gewonnen!", "success"); }
                    else UI.toast("Verloren", "error");
                }, 500);
            }
        };

        // START
        Game.init();

    </script>
</body>
</html>
